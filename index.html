<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espacio de Repaso - FICDE</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --ficde-azul-dark: #134252;
            --ficde-azul-light: #2c5c6e;
            --ficde-naranja: #e68161;
            --ficde-naranja-hover: #ff9f85;
            --tarjeta-bg: #f0f4f5;
            --input-bg: #e2e8eb;
            --texto-principal: #0f2d38;
            --texto-secundario: #4a636e;
            --verde-exito: #2e7d32;
            --verde-bg: #c8e6c9;
            --rojo-error: #c62828;
            --naranja-bg: #ffe0b2;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--ficde-azul-dark) 0%, #0a252e 100%);
            min-height: 100vh;
            color: var(--texto-principal);
            padding: 20px;
            background-attachment: fixed;
        }

        .container { max-width: 1200px; margin: 0 auto; }

        header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            border-radius: 16px;
            margin-bottom: 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .logo-img { height: 50px; width: auto; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }

        .module-tag {
            background: var(--ficde-naranja);
            color: white;
            padding: 8px 20px;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .welcome-card {
            background: var(--tarjeta-bg);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            border-bottom: 6px solid var(--ficde-naranja);
            margin-bottom: 30px;
        }

        .welcome-title {
            color: var(--ficde-azul-dark);
            font-size: 2.2rem;
            margin-bottom: 10px;
            font-weight: 800;
        }

        .fede-avatar-large {
            width: 140px; height: 140px;
            margin: 0 auto 20px;
            border-radius: 50%;
            background: var(--ficde-naranja);
            padding: 5px;
            box-shadow: 0 10px 25px rgba(230, 129, 97, 0.5);
            cursor: pointer;
            transition: transform 0.3s;
            overflow: hidden;
        }

        .fede-avatar-large:hover { transform: scale(1.1); }

        .fede-avatar-large img {
            width: 100%; height: 100%;
            object-fit: cover;
            border-radius: 50%;
            border: 4px solid white;
        }

        .blocks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 20px;
        }

        .block-card {
            background: var(--tarjeta-bg);
            padding: 30px;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border: 2px solid transparent;
        }

        .block-card:hover {
            transform: translateY(-8px);
            border-color: var(--ficde-naranja);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .block-icon {
            font-size: 3rem; margin-bottom: 15px;
            background: rgba(19, 66, 82, 0.1);
            width: 70px; height: 70px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 50%; color: var(--ficde-azul-dark);
        }

        .block-title { color: var(--ficde-azul-dark); font-size: 1.3rem; font-weight: 700; margin-bottom: 10px; }

        .block-desc { color: var(--texto-secundario); font-size: 0.9rem; line-height: 1.5; }

        .activity-screen {
            display: none;
            grid-template-columns: 280px 1fr;
            gap: 25px;
            align-items: start;
        }

        .activity-screen.active { display: grid; }

        .tutor-sidebar {
            background: var(--ficde-azul-light);
            padding: 30px;
            border-radius: 16px;
            text-align: center;
            color: white;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            position: sticky; top: 20px;
        }

        .tutor-bubble {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 12px;
            font-size: 0.95rem;
            color: var(--ficde-azul-dark);
            margin-top: 20px;
            position: relative;
            text-align: left;
        }

        .tutor-bubble::after {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            border-width: 0 10px 10px;
            border-style: solid;
            border-color: transparent transparent rgba(255,255,255,0.95);
            transform: translateX(-50%);
        }

        .activity-content {
            background: var(--tarjeta-bg);
            padding: 40px;
            border-radius: 16px;
            min-height: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .act-badge {
            background: var(--ficde-naranja);
            color: white;
            padding: 5px 15px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .act-title { font-size: 1.8rem; color: var(--ficde-azul-dark); margin: 15px 0; font-weight: 800; }

        .act-instruction { font-size: 1.1rem; color: var(--texto-secundario); margin-bottom: 30px; }

        .student-input {
            width: 100%;
            height: 150px;
            padding: 20px;
            background: var(--input-bg);
            border: 2px solid transparent;
            border-radius: 12px;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            color: var(--ficde-azul-dark);
            transition: all 0.3s;
        }

        .student-input:focus { background: white; border-color: var(--ficde-naranja); outline: none; }

        .fill-input {
            border: none;
            border-bottom: 2px solid var(--ficde-naranja);
            background: transparent;
            font-weight: 700;
            color: var(--ficde-azul-dark);
            text-align: center;
            width: 150px;
            font-size: 1.1rem;
        }

        .btn-action {
            width: 100%;
            padding: 18px;
            margin-top: 30px;
            border: none;
            border-radius: 50px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            background: linear-gradient(90deg, var(--ficde-naranja), #ff9f85);
            color: white;
            box-shadow: 0 6px 20px rgba(230, 129, 97, 0.4);
            transition: transform 0.2s;
        }

        .btn-action:hover { transform: translateY(-3px); }

        .btn-back {
            background: transparent;
            color: var(--texto-secundario);
            box-shadow: none;
            border: 2px solid #ccc;
            margin-top: 15px;
        }

        .btn-back:hover { background: #e0e0e0; color: var(--ficde-azul-dark); }

        .traffic-row, .checklist-item {
            background: white;
            margin-bottom: 12px;
            padding: 15px 20px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .traffic-row:hover, .checklist-item:hover { border-color: var(--ficde-naranja); transform: translateX(5px); }

        .traffic-btn {
            width: 35px; height: 35px;
            border-radius: 50%; border: 2px solid #ddd;
            cursor: pointer;
            opacity: 0.3;
        }

        .traffic-btn.active { opacity: 1; transform: scale(1.2); border-color: var(--ficde-azul-dark); }

        .bg-green { background: #4CAF50; }

        .bg-yellow { background: #FFC107; }

        .bg-red { background: #f44336; }

        .check-box {
            width: 24px; height: 24px;
            border: 2px solid #ccc;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
        }

        .checklist-item.selected { border-color: var(--ficde-naranja); background: #fff5f0; }

        .checklist-item.selected .check-box { background: var(--ficde-naranja); border-color: var(--ficde-naranja); color: white; }

        .feedback-area {
            margin-top: 30px;
            padding: 25px;
            border-radius: 12px;
            display: none;
            animation: slideUp 0.4s;
        }

        .feedback-success { background: var(--verde-bg); color: #1b5e20; border-left: 6px solid var(--verde-exito); }

        .feedback-retry { background: var(--naranja-bg); color: #bf360c; border-left: 6px solid #ef6c00; }

        .feedback-fail { background: #cfd8dc; color: #37474f; border-left: 6px solid #455a64; }

        #musicToggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--ficde-naranja);
            color: white;
            border: none;
            cursor: pointer;
            z-index: 100;
            font-size: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            .activity-screen { grid-template-columns: 1fr; }
            .tutor-sidebar { display: flex; align-items: center; gap: 20px; }
            .fede-avatar-large { width: 80px; height: 80px; }
            .tutor-bubble::after { display: none; }
        }
    </style>
</head>

<body>
    <!-- AUDIOS MP3 - Todos en la misma carpeta -->
    <audio id="bgMusic" loop preload="auto">
        <source src="chill-study-desk-focus-concentration-lofi-451180.mp3" type="audio/mpeg">
    </audio>

    <audio id="saludoInicial" preload="auto" src="saludoinicial.mp3"></audio>
    <audio id="mensaje1Ejercicios" preload="auto" src="mensaje1ejercicios.mp3"></audio>
    <audio id="mensaje2Ejercicios" preload="auto" src="mensaje2ejercicios.mp3"></audio>
    <audio id="mensaje3Ejercicios" preload="auto" src="mensaje3ejercicios.mp3"></audio>
    <audio id="mensaje4Ejercicios" preload="auto" src="mensaje4ejercicios.mp3"></audio>
    <audio id="respuestaCorrecta" preload="auto" src="respuestacorrecta.mp3"></audio>
    <audio id="primerError" preload="auto" src="primererror.mp3"></audio>
    <audio id="segundoError" preload="auto" src="segundoerror.mp3"></audio>
    <audio id="loLograste" preload="auto" src="lolograste.mp3"></audio>

    <audio id="hoverSound" preload="auto" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.m4a"></audio>
    <audio id="clickSound" preload="auto" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.m4a"></audio>
    <audio id="successSound" preload="auto" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.m4a"></audio>

    <button id="musicToggle" onclick="toggleMusic()">üîá</button>

    <div class="container">
        <header>
            <div class="logo-container">
                <img src="logo.png" alt="FICDE" class="logo-img" onerror="this.style.display='none'; document.getElementById('altLogo').style.display='block'">
                <h2 id="altLogo" style="display:none; color:white; font-weight:800;">FICDE</h2>
            </div>
            <div class="module-tag">M√≥dulo Primeros Auxilios</div>
        </header>

        <div id="selectionScreen">
            <div class="welcome-card">
                <div class="fede-avatar-large" onclick="playAudio('saludoInicial')">
                    <img src="personaje.gif" alt="Fede">
                </div>
                <h1 class="welcome-title">Espacio de Repaso Interactivo</h1>
                <p style="color: var(--texto-secundario); font-size: 1.1rem;">Donde el conocimiento se convierte en acci√≥n</p>
            </div>

            <div class="blocks-grid">
                <div class="block-card" onclick="startModule('sintesis')">
                    <div class="block-icon">üß†</div>
                    <div class="block-title">S√≠ntesis</div>
                    <div class="block-desc">Conceptos b√°sicos, seguridad del reanimador, OCAVE y Heimlich, heridas, hemorragias, fracturas, quemaduras y alteraciones de conciencia.</div>
                </div>

                <div class="block-card" onclick="startModule('analisis')">
                    <div class="block-icon">üîç</div>
                    <div class="block-title">An√°lisis Cr√≠tico</div>
                    <div class="block-desc">Cadena de supervivencia y RCP, control de hemorragias, manejo inicial de fracturas, quemaduras, convulsiones y cambios de glucemia.</div>
                </div>

                <div class="block-card" onclick="startModule('escenarios')">
                    <div class="block-icon">üé¨</div>
                    <div class="block-title">Escenarios</div>
                    <div class="block-desc">Situaciones de atragantamiento, inmersi√≥n, cortes profundos, ca√≠das, quemaduras, s√≠ncope, convulsiones, hipoglucemia y eventos cardiovasculares.</div>
                </div>

                <div class="block-card" onclick="startModule('practica')">
                    <div class="block-icon">‚ö°</div>
                    <div class="block-title">Pr√°ctica</div>
                    <div class="block-desc">Ejercicios de recuerdo clave, PAS, reconocimiento de OCAVE y hemorragias, mini-RCP, posici√≥n lateral y manejo seguro de quemaduras y emergencias.</div>
                </div>
            </div>
        </div>

        <div id="activityScreen" class="activity-screen">
            <div class="tutor-sidebar">
                <div class="fede-avatar-large" style="width: 100px; height: 100px; border-color: var(--ficde-naranja);" onclick="replayTutorMessage()">
                    <img src="personaje.gif" alt="Fede">
                </div>
                <div style="flex:1;">
                    <h3 style="color:var(--ficde-naranja); margin-bottom:5px;">Tutor Fede</h3>
                    <div class="tutor-bubble" id="tutorMessage"></div>
                </div>
            </div>

            <div class="activity-content" id="activityContainer"></div>
        </div>
    </div>

    <script>
        // ===== GESTI√ìN DE AUDIO MP3 =====
        const audioFiles = {
            saludoInicial: document.getElementById('saludoInicial'),
            mensaje1: document.getElementById('mensaje1Ejercicios'),
            mensaje2: document.getElementById('mensaje2Ejercicios'),
            mensaje3: document.getElementById('mensaje3Ejercicios'),
            mensaje4: document.getElementById('mensaje4Ejercicios'),
            correcto: document.getElementById('respuestaCorrecta'),
            error1: document.getElementById('primerError'),
            error2: document.getElementById('segundoError'),
            lolograste: document.getElementById('loLograste')
        };

        function playAudio(audioKey) {
            if (audioFiles[audioKey]) {
                audioFiles[audioKey].currentTime = 0;
                audioFiles[audioKey].play().catch(err => console.log('Error al reproducir audio:', err));
            }
        }

        const bgMusic = document.getElementById('bgMusic');
        const clickSoundEl = document.getElementById('clickSound');
        const successSoundEl = document.getElementById('successSound');
        const hoverSoundEl = document.getElementById('hoverSound');

        let musicOn = false;
        let audioUnlocked = false;

        function unlockAudio() {
            if (audioUnlocked) return;
            [clickSoundEl, successSoundEl, hoverSoundEl].forEach(a => {
                a.volume = 0;
                const p = a.play();
                if (p) p.then(() => { a.pause(); a.currentTime = 0; a.volume = 1; }).catch(()=>{});
            });
            audioUnlocked = true;
        }

        document.addEventListener('pointerdown', unlockAudio, { once: true });
        document.addEventListener('keydown', unlockAudio, { once: true });

        function toggleMusic() {
            unlockAudio();
            if (!musicOn) {
                bgMusic.volume = 0.1;
                bgMusic.play().catch(() => {});
                document.getElementById('musicToggle').innerText = 'üéµ';
            } else {
                bgMusic.pause();
                document.getElementById('musicToggle').innerText = 'üîá';
            }
            musicOn = !musicOn;
        }

        function playSound(type) {
            if (!audioUnlocked) return;
            try {
                if (type === 'click') { clickSoundEl.currentTime=0; clickSoundEl.volume=0.8; clickSoundEl.play().catch(()=>{}); }
                if (type === 'success') { successSoundEl.currentTime=0; successSoundEl.volume=0.8; successSoundEl.play().catch(()=>{}); }
                if (type === 'hover') { hoverSoundEl.currentTime=0; hoverSoundEl.volume=0.2; hoverSoundEl.play().catch(()=>{}); }
            } catch (e) {}
        }

        function wireUiSounds() {
            document.querySelectorAll('.block-card, .btn-action, .checklist-item, .traffic-row, .fede-avatar-large').forEach(el => {
                if (el.dataset.sound === '1') return;
                el.dataset.sound = '1';
                el.addEventListener('mouseenter', () => playSound('hover'));
                el.addEventListener('click', () => playSound('click'));
            });
        }

        window.addEventListener('load', wireUiSounds);

        // ===== NORMALIZACI√ìN DE TEXTO =====
        function normalizar(txt) {
            return txt
                .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
                .toLowerCase();
        }

       // ===== ACTIVIDADES: M√ìDULO ‚Äì PRINCIPIOS B√ÅSICOS DE DERMOCOSMETOLOG√çA Y COSMIATR√çA ===
const modules = {

    // ===================== S√çNTESIS =====================
    sintesis: [
        {
            type: 'text',
            badge: 'Cosmetolog√≠a',
            title: 'Definici√≥n de cosmetolog√≠a',
            instruction: 'Con tus palabras: ¬øqu√© es la cosmetolog√≠a y de qu√© se ocupa?',
            validation: (raw) => {
                const v = normalizar(raw);
                return (
                    v.includes('rama') &&
                    (v.includes('farmaceut') || v.includes('area de la farmacia')) &&
                    (v.includes('cosm√©tic') || v.includes('cosmetico') || v.includes('productos cosm')) &&
                    (v.includes('desarroll') || v.includes('fabric') || v.includes('investig') || v.includes('comercial'))
                );
            },
            tutor: 'Pens√° en la disciplina que desarrolla, fabrica e investiga productos cosm√©ticos para el cuidado est√©tico de la piel sana.',
            explanation: 'La cosmetolog√≠a es una rama del √°rea farmac√©utica que se ocupa de desarrollar, producir, investigar, fabricar y comercializar los productos cosm√©ticos destinados al cuidado est√©tico de la piel sana.'
        },
        {
            type: 'text',
            badge: 'Cosmiatr√≠a',
            title: 'Definici√≥n de cosmiatr√≠a',
            instruction: 'Explica qu√© es la cosmiatr√≠a y en qu√© se diferencia de la cosmetolog√≠a.',
            validation: (raw) => {
                const v = normalizar(raw);
                return (
                    (v.includes('profesion') || v.includes('ciencia') || v.includes('arte')) &&
                    v.includes('belleza') &&
                    (v.includes('piel sana') || v.includes('piel enferma')) &&
                    (v.includes('cosmiatr') || v.includes('cosm√©tico medicado') || v.includes('medicados'))
                );
            },
            tutor: 'Diferenci√° entre el cuidado est√©tico de la piel sana y el abordaje de piel sana y enferma con productos cosm√©ticos medicados.',
            explanation: 'La cosmiatr√≠a es la profesi√≥n o ciencia dedicada al estudio m√©dico de la belleza humana y al cuidado de la piel sana y enferma mediante productos cosm√©ticos medicados.'
        },
        {
            type: 'traffic',
            badge: 'Conceptos clave',
            title: 'Cosm√©tico, cosmec√©utico y cosmec√©utico',
            instruction: 'Marca en verde las afirmaciones correctas sobre los tipos de productos.',
            items: [
                { text: 'Un cosm√©tico se usa para resaltar la belleza y cuidar la piel sana', color: 'green' },
                { text: 'Un cosmec√©utico es un cosm√©tico con inter√©s m√©dico y funci√≥n tambi√©n terap√©utica', color: 'green' },
                { text: 'Todo producto cosm√©tico es, por definici√≥n, un medicamento sist√©mico', color: 'red' },
                { text: 'Los productos cosmec√©uticos son agentes t√≥picos con funci√≥n cosm√©tica y terap√©utica', color: 'green' }
            ],
            tutor: 'Pens√° en la diferencia entre un producto puramente est√©tico y uno con acci√≥n terap√©utica t√≥pica.',
            explanation: 'Los productos cosm√©ticos buscan resaltar la belleza, mientras que los cosmec√©uticos son agentes t√≥picos con funci√≥n simult√°neamente cosm√©tica y terap√©utica de inter√©s m√©dico.'
        },
        {
            type: 'checklist',
            badge: 'Belleza historia',
            title: 'Historia de la belleza',
            instruction: 'Selecciona ideas que reflejen la importancia hist√≥rica de la est√©tica y la belleza.',
            items: [
                { text: 'En la Biblia ya se describe un ‚Äúconcurso de belleza‚Äù y tratamientos cosm√©ticos prolongados', correct: true },
                { text: 'En el antiguo Egipto se usaban ung√ºentos, ba√±os de leche y maquillajes vegetales', correct: true },
                { text: 'La est√©tica integral del siglo XX combina ciencia, moda y vida cotidiana', correct: true },
                { text: 'La preocupaci√≥n por la belleza aparece reci√©n en el siglo XX', correct: false }
            ],
            tutor: 'Ubic√° ejemplos de la Biblia, Egipto y el siglo XX como hitos de la historia de la belleza.',
            explanation: 'Desde los relatos b√≠blicos, pasando por el culto a la belleza en el antiguo Egipto, hasta la est√©tica integral del siglo XX, la b√∫squeda de belleza ha sido constante y se ha nutrido de avances cient√≠ficos.'
        },
        {
            type: 'traffic',
            badge: 'Funciones piel',
            title: 'Funciones b√°sicas de la piel',
            instruction: 'Marca en verde las funciones correctas de la piel como √≥rgano.',
            items: [
                { text: 'Act√∫a como barrera frente a sustancias extra√±as, radiaciones y golpes', color: 'green' },
                { text: 'Regula la p√©rdida de calor y controla la p√©rdida de fluidos valiosos', color: 'green' },
                { text: 'Es solo una envoltura pasiva sin funci√≥n activa', color: 'red' },
                { text: 'Transmite est√≠mulos del ambiente a trav√©s de terminaciones nerviosas', color: 'green' }
            ],
            tutor: 'Pens√° en la piel como frontera activa entre el organismo y el ambiente.',
            explanation: 'La piel controla la p√©rdida de fluidos, protege frente a sustancias nocivas y radiaciones, amortigua golpes, regula la temperatura y transmite est√≠mulos sensoriales.'
        },
        {
            type: 'checklist',
            badge: 'Capas piel',
            title: 'Estructura b√°sica de la piel',
            instruction: 'Selecciona componentes estructurales de la piel descritos en el manual.',
            items: [
                { text: 'Epidermis con estrato basal y estrato c√≥rneo', correct: true },
                { text: 'Dermis con col√°geno, elastina y sustancia fundamental', correct: true },
                { text: 'Hipodermis o tejido subcut√°neo', correct: true },
                { text: 'Hueso compacto como capa superficial de la piel', correct: false }
            ],
            tutor: 'Ubic√° epidermis, dermis e hipodermis y sus elementos principales.',
            explanation: 'La piel est√° formada por una epidermis con queratinocitos en renovaci√≥n continua, una dermis rica en col√°geno y elastina y una hipodermis con tejido adiposo y vasos.'
        },
        {
            type: 'text',
            badge: 'Tipos piel',
            title: 'Tipos de piel',
            instruction: 'Nombra al menos tres tipos de piel seg√∫n la clasificaci√≥n del manual.',
            validation: (raw) => {
                const v = normalizar(raw);
                const ok =
                    (v.includes('normal') ? 1 : 0) +
                    (v.includes('mixta') ? 1 : 0) +
                    (v.includes('seca') ? 1 : 0) +
                    (v.includes('muy seca') ? 1 : 0) +
                    (v.includes('grasa') ? 1 : 0);
                return ok >= 3;
            },
            tutor: 'Record√° piel normal, mixta con tendencia seca o grasa, seca/muy seca y grasa.',
            explanation: 'Los tipos de piel se definen por producci√≥n de sebo, brillo y tama√±o de poro: piel normal, mixta (tendencia seca o grasa), seca‚Äìmuy seca y grasa.'
        },
        {
            type: 'traffic',
            badge: 'Envejecimiento',
            title: 'Envejecimiento cut√°neo',
            instruction: 'Marca en verde afirmaciones correctas sobre el envejecimiento de la piel.',
            items: [
                { text: 'Es un proceso fisiol√≥gico, universal e inexorable', color: 'green' },
                { text: 'Incluye cronoenvejecimiento, fotoenvejecimiento, hormonal y conductual', color: 'green' },
                { text: 'Solo depende de la gen√©tica y no del estilo de vida', color: 'red' },
                { text: 'Se acompa√±a de arrugas, cambios de textura, manchas y p√©rdida de firmeza', color: 'green' }
            ],
            tutor: 'Pens√° en las distintas causas: tiempo, sol, hormonas y h√°bitos.',
            explanation: 'El envejecimiento cut√°neo combina factores intr√≠nsecos y extr√≠nsecos, generando arrugas, cambios de textura, manchas y p√©rdida de densidad y firmeza.'
        },
        {
            type: 'checklist',
            badge: 'Nutrici√≥n piel',
            title: 'Nutrici√≥n y piel',
            instruction: 'Selecciona afirmaciones correctas sobre la relaci√≥n entre nutrici√≥n y piel.',
            items: [
                { text: 'La piel necesita hidratos de carbono, l√≠pidos y amino√°cidos para su metabolismo', correct: true },
                { text: 'Deficiencias de vitaminas A, B2, niacina o C pueden generar alteraciones cut√°neas', correct: true },
                { text: 'La piel no se ve afectada por la desnutrici√≥n proteica', correct: false },
                { text: 'La falta de √°cidos grasos esenciales puede causar descamaci√≥n y p√©rdida de agua', correct: true }
            ],
            tutor: 'Ubic√° el rol de vitaminas, prote√≠nas y √°cidos grasos esenciales en la salud cut√°nea.',
            explanation: 'Las deficiencias de vitaminas, prote√≠nas y √°cidos grasos esenciales se expresan en la piel con descamaci√≥n, dermatitis, mala cicatrizaci√≥n y cambios en cabello y u√±as.'
        },
        {
            type: 'traffic',
            badge: 'Hormonas',
            title: 'Hormonas y piel',
            instruction: 'Marca en verde afirmaciones correctas sobre hormonas que influyen en la piel.',
            items: [
                { text: 'Los andr√≥genos estimulan fol√≠culos pilosos y secreci√≥n seb√°cea', color: 'green' },
                { text: 'Los estr√≥genos pueden suprimir la actividad seb√°cea', color: 'green' },
                { text: 'Los corticoides t√≥picos alivian inflamaci√≥n pero su uso prolongado puede atrofiar la piel', color: 'green' },
                { text: 'No existe relaci√≥n entre hormonas y gl√°ndulas seb√°ceas', color: 'red' }
            ],
            tutor: 'Relacion√° andr√≥genos, estr√≥genos y corticoides con pelo, sebo e inflamaci√≥n.',
            explanation: 'Andr√≥genos, estr√≥genos y corticoides modifican el crecimiento del pelo, la secreci√≥n seb√°cea y la respuesta inflamatoria, influyendo en patolog√≠as como acn√© y dermatitis.'
        }
    ],

    // ===================== AN√ÅLISIS =====================
    analisis: [
        {
            type: 'text',
            badge: 'Epidermis',
            title: 'Estrato basal y estrato c√≥rneo',
            instruction: 'Describe brevemente el rol del estrato basal y del estrato c√≥rneo en la epidermis.',
            validation: (raw) => {
                const v = normalizar(raw);
                return (
                    (v.includes('basal') || v.includes('germinativ')) &&
                    (v.includes('mitosis') || v.includes('renov') || v.includes('queratinocit')) &&
                    (v.includes('corneo') || v.includes('c√≥rneo')) &&
                    (v.includes('barrera') || v.includes('protecc') || v.includes('queratina'))
                );
            },
            tutor: 'Pens√° en el estrato basal como capa germinativa y en el c√≥rneo como barrera queratinizada.',
            explanation: 'El estrato basal genera continuamente nuevos queratinocitos por mitosis, mientras que el estrato c√≥rneo forma la barrera externa de c√©lulas queratinizadas que se descaman.'
        },
        {
            type: 'checklist',
            badge: 'Melanina',
            title: 'Sistema pigmentario',
            instruction: 'Selecciona afirmaciones correctas sobre melanocitos y melanina.',
            items: [
                { text: 'La melanina se sintetiza en melanosomas por acci√≥n de la tirosinasa', correct: true },
                { text: 'Las diferencias de color de piel se deben a la cantidad de melanina producida', correct: true },
                { text: 'La funci√≥n principal de la melanina es proteger frente a la radiaci√≥n solar', correct: true },
                { text: 'Los grupos √©tnicos difieren en n√∫mero de melanocitos y no en su actividad', correct: false }
            ],
            tutor: 'Record√° que la melanina y la tirosinasa determinan el grado de pigmentaci√≥n.',
            explanation: 'La melanina, producida por melanocitos en melanosomas, protege frente a la radiaci√≥n UV y su cantidad, no el n√∫mero de melanocitos, explica la pigmentaci√≥n √©tnica.'
        },
        {
            type: 'traffic',
            badge: 'Dermis',
            title: 'Componentes de la dermis',
            instruction: 'Marca en verde componentes y funciones correctas de la dermis.',
            items: [
                { text: 'Contiene col√°geno que aporta resistencia al estiramiento', color: 'green' },
                { text: 'Incluye fibras de elastina responsables de la elasticidad', color: 'green' },
                { text: 'Carece totalmente de vasos sangu√≠neos y nervios', color: 'red' },
                { text: 'Aporta nutrientes a la epidermis y alberga ap√©ndices cut√°neos', color: 'green' }
            ],
            tutor: 'Ubic√° col√°geno, elastina, sustancia fundamental, vasos y anexos cut√°neos.',
            explanation: 'La dermis, rica en col√°geno, elastina y mucopolisac√°ridos, alberga vasos, nervios y anexos; amortigua traumatismos y nutre a la epidermis.'
        },
        {
            type: 'checklist',
            badge: 'Anexos',
            title: 'Anexos cut√°neos principales',
            instruction: 'Selecciona estructuras que sean anexos cut√°neos.',
            items: [
                { text: 'Fol√≠culos pilosos', correct: true },
                { text: 'Gl√°ndulas seb√°ceas', correct: true },
                { text: 'Gl√°ndulas sudor√≠paras ecrinas y apocrinas', correct: true },
                { text: 'M√∫sculo esquel√©tico del brazo', correct: false }
            ],
            tutor: 'Pens√° en pelo, sebo, sudor y sus estructuras asociadas.',
            explanation: 'Los anexos cut√°neos incluyen fol√≠culos pilosos, gl√°ndulas seb√°ceas y gl√°ndulas sudor√≠paras ecrinas y apocrinas, todos embebidos en la dermis.'
        },
        {
            type: 'traffic',
            badge: 'Absorci√≥n',
            title: 'Absorci√≥n percut√°nea',
            instruction: 'Marca en verde afirmaciones correctas sobre la absorci√≥n a trav√©s de la piel.',
            items: [
                { text: 'La principal barrera es el estrato c√≥rneo', color: 'green' },
                { text: 'La hidrataci√≥n del estrato c√≥rneo puede aumentar la penetraci√≥n de sustancias', color: 'green' },
                { text: 'Los iones en soluci√≥n acuosa atraviesan f√°cilmente la piel intacta', color: 'red' },
                { text: 'Ciertos disolventes como el DMSO incrementan la penetraci√≥n de otros solutos', color: 'green' }
            ],
            tutor: 'Relacion√° barrera c√≥rnea, hidrataci√≥n, veh√≠culo y disolventes especiales.',
            explanation: 'La piel intacta es poco permeable gracias al estrato c√≥rneo, aunque la hidrataci√≥n, la oclusi√≥n y disolventes como el DMSO incrementan la absorci√≥n de ciertos compuestos.'
        },
        {
            type: 'checklist',
            badge: 'Tipos piel detalle',
            title: 'Caracter√≠sticas de tipos de piel',
            instruction: 'Relaciona cada frase con tipos de piel seg√∫n el manual.',
            items: [
                { text: 'Piel normal: color uniforme, mate, poros imperceptibles y tacto aterciopelado', correct: true },
                { text: 'Piel seca: mate, √°spera, poros imperceptibles y tendencia a descamaci√≥n', correct: true },
                { text: 'Piel grasa: brillo marcado, poros dilatados, comedones abiertos y microquistes', correct: true },
                { text: 'Piel normal: siempre presenta descamaciones intensas y rojez', correct: false }
            ],
            tutor: 'Fijate en brillo, poros, textura y tolerancia a las variaciones clim√°ticas.',
            explanation: 'Los tipos de piel se diferencian por brillo, tama√±o de poro, textura y reactividad, determinando necesidades espec√≠ficas de hidrataci√≥n, nutrici√≥n o control seb√°ceo.'
        },
        {
            type: 'text',
            badge: 'Hiperpigmentaci√≥n',
            title: 'Concepto de hiperpigmentaci√≥n',
            instruction: 'Describe qu√© es la hiperpigmentaci√≥n y menciona un ejemplo.',
            validation: (raw) => {
                const v = normalizar(raw);
                return (
                    v.includes('aumento') &&
                    (v.includes('pigment') || v.includes('melanina')) &&
                    (v.includes('melasma') || v.includes('cloasma') || v.includes('manchas') || v.includes('pecas'))
                );
            },
            tutor: 'Pod√©s mencionar melasma, manchas por sol o queratosis act√≠nicas pigmentadas.',
            explanation: 'La hiperpigmentaci√≥n es un aumento localizado o difuso del pigmento cut√°neo, como en el melasma facial o las manchas inducidas por exposici√≥n solar.'
        },
        {
            type: 'traffic',
            badge: 'Ros√°cea',
            title: 'Datos clave de ros√°cea',
            instruction: 'Marca en verde afirmaciones correctas sobre ros√°cea.',
            items: [
                { text: 'Es un trastorno persistente con eritema y telangiectasias en la cara central', color: 'green' },
                { text: 'Puede incluir p√°pulas y p√∫stulas (acn√© ros√°cea) en etapas avanzadas', color: 'green' },
                { text: 'Se cura definitivamente con una √∫nica sesi√≥n de tratamiento', color: 'red' },
                { text: 'Impacta en la autoestima y puede asociarse a ansiedad o depresi√≥n', color: 'green' }
            ],
            tutor: 'Record√° las etapas I a IV y los s√≠ntomas vasculares e inflamatorios.',
            explanation: 'La ros√°cea causa enrojecimiento facial persistente, telangiectasias y lesiones inflamatorias, sin cura definitiva, y suele afectar la esfera emocional del paciente.'
        },
        {
            type: 'checklist',
            badge: 'Acn√©',
            title: 'Factores en acn√© vulgar',
            instruction: 'Selecciona factores que intervienen en el desarrollo del acn√© vulgar.',
            items: [
                { text: 'Hiperqueratinizaci√≥n del cuello folicular y aumento de sebo', correct: true },
                { text: 'Presencia de bacterias como Cutibacterium (Corynebacterium) acnes', correct: true },
                { text: 'Cambios hormonales y estr√©s', correct: true },
                { text: '√önicamente el consumo de chocolate como causa principal', correct: false }
            ],
            tutor: 'Relacion√° fol√≠culo piloseb√°ceo, sebo, bacterias y hormonas.',
            explanation: 'El acn√© vulgar se asocia con exceso de sebo, obstrucci√≥n folicular, proliferaci√≥n bacteriana y factores hormonales y ambientales.'
        },
        {
            type: 'traffic',
            badge: 'Caspa',
            title: 'Caspa seca y grasa',
            instruction: 'Marca en verde afirmaciones correctas sobre caspa.',
            items: [
                { text: 'La caspa seca presenta escamas finas, blancas o gris√°ceas', color: 'green' },
                { text: 'La caspa grasa muestra placas amarillentas y grasientas que pueden asociarse a ca√≠da de cabello', color: 'green' },
                { text: 'La caspa es t√≠pica de la infancia temprana y rara en adultos', color: 'red' },
                { text: 'Se considera m√°s un estado fisiol√≥gico cr√≥nico que una enfermedad aguda', color: 'green' }
            ],
            tutor: 'Diferenci√° pityriasis simplex (seca) de pityriasis steatoide (grasa).',
            explanation: 'La caspa se manifiesta como descamaci√≥n cr√≥nica del cuero cabelludo, en forma seca o grasa, y suele persistir en la vida adulta, con posible ca√≠da asociada en formas severas.'
        }
    ],

    // ===================== ESCENARIOS =====================
    escenarios: [
        {
            type: 'text',
            badge: 'Piel mixta',
            title: 'Recomendaci√≥n para piel mixta',
            instruction: 'Una clienta con piel mixta con tendencia grasa consulta qu√© tipo de productos faciales deber√≠a usar a diario. ¬øQu√© caracter√≠sticas recomendar√≠as para limpiador e hidratante?',
            validation: (raw) => {
                const v = normalizar(raw);
                return (
                    (v.includes('zona t') || v.includes('frente') || v.includes('nariz') || v.includes('menton')) &&
                    (v.includes('hidrat') || v.includes('ligera') || v.includes('oil free') || v.includes('no comedog')) &&
                    (v.includes('seborregul') || v.includes('matificante') || v.includes('control de brillo'))
                );
            },
            tutor: 'Record√° que la piel mixta con tendencia grasa necesita limpieza suave, control de sebo en zona T e hidrataci√≥n ligera en todo el rostro.',
            explanation: 'En piel mixta con tendencia grasa se prefieren limpiadores suaves que no resequen en exceso y cremas o geles hidratantes ligeros, seborreguladores, no comedog√©nicos y matificantes.'
        },
        {
            type: 'traffic',
            badge: 'Melasma',
            title: 'Manejo de melasma',
            instruction: 'Marca en verde conductas adecuadas frente a un caso de melasma facial.',
            items: [
                { text: 'Recomendar fotoprotecci√≥n diaria de amplio espectro', color: 'green' },
                { text: 'Sugerir ingredientes despigmentantes como √°cido k√≥jico o azelaico bajo supervisi√≥n m√©dica', color: 'green' },
                { text: 'Usar de inmediato peelings profundos y l√°ser sin evaluar fototipo ni riesgos', color: 'red' },
                { text: 'Explicar que la condici√≥n puede reactivarse con el sol o inflamaci√≥n', color: 'green' }
            ],
            tutor: 'Pens√° en el rol del cosmiatra y del dermat√≥logo en casos profundos y recidivantes.',
            explanation: 'El melasma requiere fotoprotecci√≥n estricta, uso prudente de despigmentantes y, en casos seleccionados, peelings o l√°ser indicados por dermatolog√≠a, ya que tiende a recidivar con el sol.'
        },
        {
            type: 'checklist',
            badge: 'Ros√°cea consejo',
            title: 'Escenario de ros√°cea',
            instruction: 'Selecciona recomendaciones apropiadas para una persona con ros√°cea eritematosa.',
            items: [
                { text: 'Evitar alimentos picantes, alcohol y cambios bruscos de temperatura', correct: true },
                { text: 'Usar productos suaves, no irritantes y sin fricci√≥n intensa', correct: true },
                { text: 'Aplicar vapor caliente y masajes vigorosos para ‚Äúactivar la circulaci√≥n‚Äù', correct: false },
                { text: 'Usar protector solar con √≥xido de zinc a diario', correct: true }
            ],
            tutor: 'Record√° que la ros√°cea empeora con calor, irritaci√≥n, sol y ciertos alimentos.',
            explanation: 'En ros√°cea se recomiendan cambios de estilo de vida, cosm√©tica suave y fotoprotecci√≥n mineral, evitando calor excesivo, fricci√≥n y agentes irritantes.'
        },
        {
            type: 'text',
            badge: 'Acn√© mostrador',
            title: 'Consejo para acn√© leve',
            instruction: 'Un adolescente consulta por acn√© leve en la farmacia. ¬øQu√© pautas b√°sicas de higiene y productos de venta libre podr√≠as sugerirle?',
            validation: (raw) => {
                const v = normalizar(raw);
                return (
                    v.includes('lavar') &&
                    (v.includes('suave') || v.includes('no comedogen') || v.includes('jabon') || v.includes('limpiador')) &&
                    (v.includes('1 o 2 veces') || v.includes('una o dos veces') || v.includes('no frotar')) &&
                    (v.includes('peroxido') || v.includes('acido salicilico') || v.includes('no manipular') || v.includes('no apretar'))
                );
            },
            tutor: 'Inclu√≠ limpieza suave, no manipular lesiones y posible uso de per√≥xido de benzoilo o √°cido salic√≠lico de venta libre.',
            explanation: 'El manejo inicial del acn√© leve incluye higiene suave una o dos veces al d√≠a, uso de productos no comedog√©nicos y, si es necesario, per√≥xido de benzoilo o √°cido salic√≠lico t√≥picos, evitando apretar granos.'
        },
        {
            type: 'traffic',
            badge: 'Vitiligo',
            title: 'Orientaci√≥n en vitiligo',
            instruction: 'Marca en verde afirmaciones adecuadas sobre orientaci√≥n a un paciente con vitiligo.',
            items: [
                { text: 'Explicar que es una despigmentaci√≥n con ausencia de melanina y melanocitos en las zonas afectadas', color: 'green' },
                { text: 'Aconsejar uso riguroso de fotoprotectores de alto FPS', color: 'green' },
                { text: 'Prometer repigmentaci√≥n completa y definitiva con cremas cosm√©ticas simples', color: 'red' },
                { text: 'Mencionar que fototerapia y medicamentos t√≥picos pueden ser opciones m√©dicas', color: 'green' }
            ],
            tutor: 'Pens√° en la fragilidad de la piel despigmentada y en el rol de la derivaci√≥n al dermat√≥logo.',
            explanation: 'El vitiligo implica ausencia de melanina y melanocitos, requiere fotoprotecci√≥n intensa y suele manejarse con fototerapia y f√°rmacos t√≥picos bajo supervisi√≥n dermatol√≥gica.'
        },
        {
            type: 'checklist',
            badge: 'Psoriasis',
            title: 'Escenario de psoriasis',
            instruction: 'Selecciona mensajes correctos al orientar a un paciente con psoriasis.',
            items: [
                { text: 'Aclarar que no es contagiosa', correct: true },
                { text: 'Mencionar que las placas se asocian a alta proliferaci√≥n epid√©rmica', correct: true },
                { text: 'Recomendar suspender por cuenta propia los tratamientos m√©dicos cuando haya mejor√≠a', correct: false },
                { text: 'Comentar que se pueden usar tratamientos t√≥picos, sist√©micos y fototerapia', correct: true }
            ],
            tutor: 'Record√° la cronicidad de la psoriasis y la necesidad de manejo m√©dico supervisado.',
            explanation: 'La psoriasis se caracteriza por placas escamosas no contagiosas y se maneja con terapias t√≥picas, sist√©micas y fototerapia, siempre bajo control profesional.'
        },
        {
            type: 'text',
            badge: 'Caspa mostrador',
            title: 'Consejo frente a caspa',
            instruction: 'Un cliente consulta por caspa abundante. ¬øQu√© tipo de champ√∫ y recomendaciones generales podr√≠as darle?',
            validation: (raw) => {
                const v = normalizar(raw);
                return (
                    (v.includes('champu') || v.includes('shampoo')) &&
                    (v.includes('disulfuro de selenio') || v.includes('piritiona de zinc') || v.includes('ketoconazol') || v.includes('acido salicilico')) &&
                    (v.includes('uso regular') || v.includes('2 o 3 veces') || v.includes('frecuente')) &&
                    (v.includes('consultar') || v.includes('dermatolog') || v.includes('si no mejora'))
                );
            },
            tutor: 'Pod√©s sugerir champ√∫s con disulfuro de selenio, piritiona de zinc, ketoconazol o √°cido salic√≠lico y derivar si no hay mejor√≠a.',
            explanation: 'El tratamiento de la caspa incluye champ√∫s con activos como disulfuro de selenio, piritiona de zinc, ketoconazol o √°cido salic√≠lico, usados de forma regular, con derivaci√≥n m√©dica si persiste.'
        },
        {
            type: 'traffic',
            badge: 'Fotoprotecci√≥n',
            title: 'Escenario de fotoenvejecimiento',
            instruction: 'Marca en verde mensajes adecuados para una persona preocupada por el fotoenvejecimiento.',
            items: [
                { text: 'Usar protector solar todo el a√±o, incluso en d√≠as nublados', color: 'green' },
                { text: 'Entender que la radiaci√≥n UV contribuye a arrugas, manchas y tumoraciones cut√°neas', color: 'green' },
                { text: 'Reservar el protector solo para la playa o la pileta', color: 'red' },
                { text: 'Complementar con antioxidantes t√≥picos e hidratantes adecuados', color: 'green' }
            ],
            tutor: 'Relacion√° radiaci√≥n UV con arrugas, manchas y lesiones premalignas.',
            explanation: 'El fotoenvejecimiento se previene con fotoprotecci√≥n diaria, antioxidantes y cuidados dermocosm√©ticos que preservan col√°geno, elastina y uniformidad del tono.'
        },
        {
            type: 'checklist',
            badge: 'Depilaci√≥n',
            title: 'Escenario de depilaci√≥n',
            instruction: 'Selecciona recomendaciones prudentes para una clienta que desea depilarse zonas sensibles.',
            items: [
                { text: 'Evaluar tipo de piel y zona antes de elegir el m√©todo depilatorio', correct: true },
                { text: 'Advertir sobre posible irritaci√≥n o foliculitis post-depilaci√≥n', correct: true },
                { text: 'Aplicar cualquier producto sin prueba previa en piel sensible', correct: false },
                { text: 'Sugerir productos calmantes y evitar sol inmediato tras depilaci√≥n', correct: true }
            ],
            tutor: 'Pens√° en el equilibrio entre resultado est√©tico y respeto de la barrera cut√°nea.',
            explanation: 'La depilaci√≥n requiere considerar tipo de piel y zona, advertir sobre irritaciones y acompa√±ar con productos calmantes y fotoprotecci√≥n posterior.'
        },
        {
            type: 'text',
            badge: 'Camuflaje',
            title: 'Maquillaje de camuflaje',
            instruction: 'Una persona con ros√°cea o melasma consulta por maquillaje. ¬øQu√© pautas b√°sicas le dar√≠as sobre maquillaje de camuflaje?',
            validation: (raw) => {
                const v = normalizar(raw);
                return (
                    (v.includes('no comedog') || v.includes('oil free') || v.includes('hipoalerg')) &&
                    (v.includes('alta cobertura') || v.includes('camuflaje') || v.includes('corrector')) &&
                    (v.includes('retirar') || v.includes('desmaquillar') || v.includes('limpieza suave'))
                );
            },
            tutor: 'Indic√° productos hipoalerg√©nicos, de alta cobertura, compatibles con la patolog√≠a y una rutina de desmaquillaje suave.',
            explanation: 'El maquillaje de camuflaje en ros√°cea o melasma debe ser hipoalerg√©nico, no comedog√©nico, de buena cobertura y combinarse con limpieza y cuidado suave para no agravar la piel.'
        }
    ],

    // ===================== PR√ÅCTICA =====================
    practica: [
        {
            type: 'blanks',
            badge: 'Definiciones',
            title: 'Cosmetolog√≠a y cosmiatr√≠a',
            instruction: 'Completa: la cosmetolog√≠a es una rama del √°rea ______ que desarrolla y fabrica ______; la cosmiatr√≠a aborda la belleza humana y el cuidado de la piel sana y ______ con cosm√©ticos medicados.',
            blanks: ['farmac√©utica', 'cosm√©ticos', 'enferma'],
            tutor: 'Record√° la relaci√≥n de la cosmetolog√≠a con el √°rea farmac√©utica y el foco m√©dico de la cosmiatr√≠a.',
            explanation: 'La cosmetolog√≠a pertenece al √°rea farmac√©utica y se centra en cosm√©ticos, mientras que la cosmiatr√≠a incorpora criterios m√©dicos para tratar piel sana y enferma.'
        },
        {
            type: 'checklist',
            badge: 'Capas pr√°ctica',
            title: 'Capas de la piel',
            instruction: 'Selecciona enunciados correctos sobre capas de la piel.',
            items: [
                { text: 'La epidermis se renueva continuamente desde el estrato basal', correct: true },
                { text: 'El estrato c√≥rneo act√∫a como barrera principal frente al exterior', correct: true },
                { text: 'La dermis contiene col√°geno y elastina que aportan firmeza y elasticidad', correct: true },
                { text: 'La hipodermis est√° formada principalmente por tejido √≥seo', correct: false }
            ],
            tutor: 'Ubic√° funciones espec√≠ficas de epidermis, dermis e hipodermis.',
            explanation: 'Cada capa de la piel aporta funciones espec√≠ficas: barrera, soporte el√°stico y reserva energ√©tica y de aislamiento.'
        },
        {
            type: 'traffic',
            badge: 'Tipo piel',
            title: 'Identificar tipo de piel',
            instruction: 'Marca en verde las descripciones que correspondan a un tipo de piel correctamente definido.',
            items: [
                { text: 'Piel normal: mate, luminosa, poros imperceptibles y tacto aterciopelado', color: 'green' },
                { text: 'Piel mixta-grasa: zona T brillante con poros dilatados y p√≥mulos m√°s mates', color: 'green' },
                { text: 'Piel muy seca: √°spera, sin luminosidad y con descamaci√≥n evidente', color: 'green' },
                { text: 'Piel grasa: sin brillo, poros cerrados y aspecto apagado', color: 'red' }
            ],
            tutor: 'Prest√° atenci√≥n a brillo, poros y textura para clasificar.',
            explanation: 'La correcta identificaci√≥n del tipo de piel gu√≠a la elecci√≥n de productos hidratantes, nutritivos o seborreguladores.'
        },
        {
            type: 'checklist',
            badge: 'Acn√© cuidados',
            title: 'Cuidados personales en acn√©',
            instruction: 'Selecciona conductas adecuadas en el cuidado del acn√©.',
            items: [
                { text: 'Lavar el rostro 1‚Äì2 veces al d√≠a con limpiadores suaves', correct: true },
                { text: 'Usar productos no comedog√©nicos y a base de agua', correct: true },
                { text: 'Apretar y rascar granos para vaciarlos m√°s r√°pido', correct: false },
                { text: 'Retirar bien el maquillaje antes de dormir', correct: true }
            ],
            tutor: 'Record√° evitar la manipulaci√≥n de lesiones y los cosm√©ticos oclusivos.',
            explanation: 'La higiene suave, los productos no comedog√©nicos y el desmaquillaje adecuado ayudan a controlar el acn√© y prevenir cicatrices.'
        },
        {
            type: 'text',
            badge: 'Casos pigmento',
            title: 'Diferenciar ef√©lides, l√©ntigos y lunares',
            instruction: 'Explica brevemente la diferencia entre pecas (ef√©lides), l√©ntigos y lunares.',
            validation: (raw) => {
                const v = normalizar(raw);
                return (
                    v.includes('pecas') &&
                    (v.includes('sol') || v.includes('uv') || v.includes('radiacion')) &&
                    (v.includes('lentig') || v.includes('edad') || v.includes('mas pronunciados')) &&
                    v.includes('lunares')
                );
            },
            tutor: 'Mencion√° que las pecas suelen ser m√°s claras y relacionadas al sol, los l√©ntigos a la edad y los lunares m√°s pigmentados.',
            explanation: 'Las ef√©lides son pecas claras ligadas a la radiaci√≥n UV, los l√©ntigos se asocian al envejecimiento y los lunares son lesiones m√°s pigmentadas y menos numerosas.'
        },
        {
            type: 'traffic',
            badge: 'Cremas',
            title: 'Tipos de cremas cut√°neas',
            instruction: 'Marca en verde afirmaciones correctas sobre cremas para la piel.',
            items: [
                { text: 'Las cremas hidratantes suelen tener menor contenido oleoso y se absorben r√°pido', color: 'green' },
                { text: 'Las cremas de noche y masaje son m√°s oleosas y oclusivas', color: 'green' },
                { text: 'Las lociones son emulsiones de alta viscosidad que no fluyen', color: 'red' },
                { text: 'Las cremas protectoras de manos suelen ser aceite-agua con factores de protecci√≥n', color: 'green' }
            ],
            tutor: 'Diferenci√° por contenido de aceite, textura y funci√≥n principal.',
            explanation: 'La elecci√≥n entre cremas de noche, hidratantes o protectoras depende de la necesidad de oclusi√≥n, confort y tipo de piel.'
        },
        {
            type: 'checklist',
            badge: 'M√°scaras',
            title: 'M√°scaras de belleza',
            instruction: 'Selecciona afirmaciones correctas sobre las m√°scaras faciales.',
            items: [
                { text: 'Son mezclas que se aplican en capa, se secan y ejercen una acci√≥n f√≠sica sobre el cutis', correct: true },
                { text: 'Pueden ser detergentes, astringentes, nutritivas, calmantes o blanqueadoras', correct: true },
                { text: 'Su acci√≥n principal es limpiar profundamente y tiene efecto transitorio', correct: true },
                { text: 'No deben contener nunca sustancias activas, solo excipientes inertes', correct: false }
            ],
            tutor: 'Record√° la base pl√°stica y la adici√≥n de activos seg√∫n el objetivo cosm√©tico.',
            explanation: 'Las m√°scaras combinan acci√≥n f√≠sica de oclusi√≥n y secado con activos espec√≠ficos para limpiar, tensar, nutrir o calmar la piel.'
        },
        {
            type: 'blanks',
            badge: 'Hidrataci√≥n',
            title: 'Mecanismos de hidrataci√≥n',
            instruction: 'Completa: la piel seca puede mejorarse mediante ______ (reducir la p√©rdida de agua), uso de ______ (sustancias que atraen agua) y restituci√≥n de sustancias ______.',
            blanks: ['oclusi√≥n', 'humectantes', 'deficitarias'],
            tutor: 'Pens√° en oclusivos, humectantes y reposici√≥n de l√≠pidos o componentes faltantes.',
            explanation: 'La hidrataci√≥n se potencia reduciendo la p√©rdida de agua con oclusivos, usando humectantes y restaurando componentes estructurales escasos.'
        },
        {
            type: 'traffic',
            badge: 'Vitaminas t√≥picas',
            title: 'Vitaminas en cremas',
            instruction: 'Marca en verde afirmaciones correctas sobre uso t√≥pico de vitaminas.',
            items: [
                { text: 'Las vitaminas liposolubles y hidrosolubles pueden absorberse a trav√©s de la piel', color: 'green' },
                { text: 'Las cremas pueden aportar concentraciones locales altas de ciertas vitaminas', color: 'green' },
                { text: 'La vitamina D en cosm√©tica se corrige mejor solo por v√≠a t√≥pica', color: 'red' },
                { text: 'Es importante estabilizar las vitaminas para que sean efectivas en cremas', color: 'green' }
            ],
            tutor: 'Ubic√° vitaminas A, E, C y complejo B como ejemplos frecuentes.',
            explanation: 'Las vitaminas t√≥picas requieren formulaciones estables para ejercer efectos locales beneficiosos en la piel.'
        },
        {
            type: 'checklist',
            badge: 'No hacer da√±o',
            title: 'Aplicar ‚Äúprimero, no hacer da√±o‚Äù en dermocosm√©tica',
            instruction: 'Selecciona pr√°cticas que respetan el principio de no da√±ar en el consejo dermocosm√©tico.',
            items: [
                { text: 'No recomendar productos agresivos en piel con barrera alterada', correct: true },
                { text: 'Derivar al dermat√≥logo cuadros graves o que no mejoran', correct: true },
                { text: 'Insistir en tratamientos caseros irritantes si el cliente lo pide', correct: false },
                { text: 'Advertir sobre posibles reacciones de fotosensibilidad con ciertos ingredientes', correct: true }
            ],
            tutor: 'Pens√° en proteger la integridad cut√°nea y derivar cuando excede el √°mbito cosm√©tico.',
            explanation: 'El principio de ‚Äúno hacer da√±o‚Äù gu√≠a la elecci√≥n prudente de productos, la advertencia sobre riesgos y la derivaci√≥n a dermatolog√≠a cuando corresponde.'
        }
    ]
};

        let currentModule = '';
        let currentIndex = 0;
        let attemptCount = 0;
        let lastAudioModule = null;

        // ===== MAPEO DE M√ìDULOS A AUDIOS =====
        const moduloAudioMap = {
            'sintesis': 'mensaje1',
            'analisis': 'mensaje2',
            'escenarios': 'mensaje3',
            'practica': 'mensaje4'
        };

        function startModule(id) {
            playSound('click');
            currentModule = id;
            currentIndex = 0;
            attemptCount = 0;
            lastAudioModule = id;

            // Reproducir el audio del m√≥dulo correspondiente
            const audioKey = moduloAudioMap[id];
            if (audioKey) {
                playAudio(audioKey);
            }

            document.getElementById('selectionScreen').style.display = 'none';
            document.getElementById('activityScreen').classList.add('active');

            setTimeout(loadActivity, 300);
        }

        function loadActivity() {
            attemptCount = 0;

            if (currentIndex >= modules[currentModule].length) {
                // Reproducir "lolograste.mp3" al terminar TODAS las preguntas
                playAudio('lolograste');
                playSound('success');
                alert('¬°Excelente! Completaste este bloque.');
                setTimeout(() => {
                    location.reload();
                }, 2000);
                return;
            }

            const data = modules[currentModule][currentIndex];
            const container = document.getElementById('activityContainer');

            const msg = `Pregunta ${currentIndex + 1} de ${modules[currentModule].length}: ${data.tutor}`;
            document.getElementById('tutorMessage').innerText = msg;

            let html = `<span class="act-badge">${data.badge}</span>
                        <h2 class="act-title">${data.title}</h2>
                        <p class="act-instruction">${data.instruction}</p>`;

            if (data.type === 'text') {
                html += `<textarea id="txtInput" class="student-input" placeholder="Escribe tu respuesta con tus palabras..."></textarea>`;
            } else if (data.type === 'blanks') {
                html += `<div style="font-size:1.2rem; line-height:2.5;">`;
                data.blanks.forEach((b, i) => {
                    html += `${i + 1}. <input type="text" class="fill-input" data-ans="${b}"> <br>`;
                });
                html += `</div>`;
            } else if (data.type === 'traffic') {
                data.items.forEach((item, i) => {
                    html += `<div class="traffic-row" id="row-${i}">
                                <span>${item.text}</span>
                                <div style="display:flex; gap:10px;">
                                    <div class="traffic-btn bg-green" onclick="selTraffic(${i}, 'green')"></div>
                                    <div class="traffic-btn bg-yellow" onclick="selTraffic(${i}, 'yellow')"></div>
                                    <div class="traffic-btn bg-red" onclick="selTraffic(${i}, 'red')"></div>
                                </div>
                            </div>`;
                });
            } else if (data.type === 'checklist') {
                data.items.forEach((item) => {
                    html += `<div class="checklist-item" onclick="toggleCheck(this)" data-correct="${item.correct}">
                                <div class="check-box"></div>
                                <span>${item.text}</span>
                            </div>`;
                });
            }

            html += `<div id="feedback" class="feedback-area"></div>
                     <button id="btnCheck" class="btn-action" onclick="validate()">Verificar respuesta</button>
                     <button class="btn-action btn-back" onclick="location.reload()">Salir al men√∫</button>`;

            container.innerHTML = html;
            wireUiSounds();
        }

        let trafficAns = {};

        function selTraffic(idx, color) {
            trafficAns[idx] = color;
            const row = document.getElementById(`row-${idx}`);
            row.querySelectorAll('.traffic-btn').forEach(b => b.classList.remove('active'));
            row.querySelector(`.bg-${color}`).classList.add('active');
            playSound('click');
        }

        function toggleCheck(el) {
            el.classList.toggle('selected');
            el.querySelector('.check-box').innerText = el.classList.contains('selected') ? '‚úì' : '';

            if (el.classList.contains('selected')) {
                el.style.borderColor = 'var(--ficde-naranja)';
                el.querySelector('.check-box').style.background = 'var(--ficde-naranja)';
                el.querySelector('.check-box').style.borderColor = 'var(--ficde-naranja)';
                el.querySelector('.check-box').style.color = 'white';
            } else {
                el.style.borderColor = 'transparent';
                el.querySelector('.check-box').style.background = 'transparent';
                el.querySelector('.check-box').style.borderColor = '#ccc';
            }

            playSound('click');
        }

        function validate() {
            const data = modules[currentModule][currentIndex];
            const feedback = document.getElementById('feedback');
            let isCorrect = false;

            if (data.type === 'text') {
                const val = document.getElementById('txtInput').value;
                isCorrect = data.validation(val);
            } else if (data.type === 'blanks') {
                const inputs = document.querySelectorAll('.fill-input');
                let hits = 0;
                inputs.forEach(inp => {
                    const v = normalizar(inp.value);
                    const ans = normalizar(inp.dataset.ans);
                    if (v.length > 1 && ans.startsWith(v.slice(0, Math.max(2, Math.min(v.length, ans.length))))) hits++;
                });
                isCorrect = (hits === data.blanks.length);
            } else if (data.type === 'traffic') {
                let hits = 0;
                data.items.forEach((item, i) => { if (trafficAns[i] === item.color) hits++; });
                isCorrect = (hits === data.items.length);
            } else if (data.type === 'checklist') {
                let correct = true;
                document.querySelectorAll('.checklist-item').forEach(item => {
                    const sel = item.classList.contains('selected');
                    const should = item.dataset.correct === 'true';
                    if (sel !== should) correct = false;
                });
                isCorrect = correct;
            }

            feedback.style.display = 'block';

            if (isCorrect) {
                playAudio('correcto');
                playSound('success');
                feedback.className = 'feedback-area feedback-success';
                feedback.innerHTML = `<strong>¬°Muy bien!</strong><br>${data.explanation}`;
                document.getElementById('btnCheck').innerText = 'Siguiente pregunta ‚Üí';
                document.getElementById('btnCheck').onclick = () => { currentIndex++; loadActivity(); };
            } else {
                attemptCount++;

                if (attemptCount < 2) {
                    playAudio('error1');
                    feedback.className = 'feedback-area feedback-retry';
                    feedback.innerHTML = `<strong>Buen intento.</strong> Revis√° tu respuesta. Pista: ${data.tutor}`;
                } else {
                    playAudio('error2');
                    feedback.className = 'feedback-area feedback-fail';
                    feedback.innerHTML = `<strong>No pasa nada, aprendamos juntos:</strong><br>${data.explanation}`;
                    document.getElementById('btnCheck').innerText = 'Entendido, continuar ‚Üí';
                    document.getElementById('btnCheck').onclick = () => { currentIndex++; loadActivity(); };
                }
            }
        }

        function replayTutorMessage() {
            // Replay del √∫ltimo audio de m√≥dulo reproducido
            if (lastAudioModule) {
                const audioKey = moduloAudioMap[lastAudioModule];
                if (audioKey) {
                    playAudio(audioKey);
                }
            }
        }
    </script>
</body>
</html>