<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espacio de Repaso - FICDE</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --ficde-azul-dark: #134252;
            --ficde-azul-light: #2c5c6e;
            --ficde-naranja: #e68161;
            --ficde-naranja-hover: #ff9f85;
            --tarjeta-bg: #f0f4f5;
            --input-bg: #e2e8eb;
            --texto-principal: #0f2d38;
            --texto-secundario: #4a636e;
            --verde-exito: #2e7d32;
            --verde-bg: #c8e6c9;
            --rojo-error: #c62828;
            --naranja-bg: #ffe0b2;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--ficde-azul-dark) 0%, #0a252e 100%);
            min-height: 100vh;
            color: var(--texto-principal);
            padding: 20px;
            background-attachment: fixed;
        }

        .container { max-width: 1200px; margin: 0 auto; }

        header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            border-radius: 16px;
            margin-bottom: 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .logo-img { height: 50px; width: auto; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }

        .module-tag {
            background: var(--ficde-naranja);
            color: white;
            padding: 8px 20px;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .welcome-card {
            background: var(--tarjeta-bg);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            border-bottom: 6px solid var(--ficde-naranja);
            margin-bottom: 30px;
        }

        .welcome-title {
            color: var(--ficde-azul-dark);
            font-size: 2.2rem;
            margin-bottom: 10px;
            font-weight: 800;
        }

        .fede-avatar-large {
            width: 140px; height: 140px;
            margin: 0 auto 20px;
            border-radius: 50%;
            background: var(--ficde-naranja);
            padding: 5px;
            box-shadow: 0 10px 25px rgba(230, 129, 97, 0.5);
            cursor: pointer;
            transition: transform 0.3s;
            overflow: hidden;
        }

        .fede-avatar-large:hover { transform: scale(1.1); }

        .fede-avatar-large img {
            width: 100%; height: 100%;
            object-fit: cover;
            border-radius: 50%;
            border: 4px solid white;
        }

        .blocks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 20px;
        }

        .block-card {
            background: var(--tarjeta-bg);
            padding: 30px;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border: 2px solid transparent;
        }

        .block-card:hover {
            transform: translateY(-8px);
            border-color: var(--ficde-naranja);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .block-icon {
            font-size: 3rem; margin-bottom: 15px;
            background: rgba(19, 66, 82, 0.1);
            width: 70px; height: 70px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 50%; color: var(--ficde-azul-dark);
        }

        .block-title { color: var(--ficde-azul-dark); font-size: 1.3rem; font-weight: 700; margin-bottom: 10px; }

        .block-desc { color: var(--texto-secundario); font-size: 0.9rem; line-height: 1.5; }

        .activity-screen {
            display: none;
            grid-template-columns: 280px 1fr;
            gap: 25px;
            align-items: start;
        }

        .activity-screen.active { display: grid; }

        .tutor-sidebar {
            background: var(--ficde-azul-light);
            padding: 30px;
            border-radius: 16px;
            text-align: center;
            color: white;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            position: sticky; top: 20px;
        }

        .tutor-bubble {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 12px;
            font-size: 0.95rem;
            color: var(--ficde-azul-dark);
            margin-top: 20px;
            position: relative;
            text-align: left;
        }

        .tutor-bubble::after {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            border-width: 0 10px 10px;
            border-style: solid;
            border-color: transparent transparent rgba(255,255,255,0.95);
            transform: translateX(-50%);
        }

        .activity-content {
            background: var(--tarjeta-bg);
            padding: 40px;
            border-radius: 16px;
            min-height: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .act-badge {
            background: var(--ficde-naranja);
            color: white;
            padding: 5px 15px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .act-title { font-size: 1.8rem; color: var(--ficde-azul-dark); margin: 15px 0; font-weight: 800; }

        .act-instruction { font-size: 1.1rem; color: var(--texto-secundario); margin-bottom: 30px; }

        .student-input {
            width: 100%;
            height: 150px;
            padding: 20px;
            background: var(--input-bg);
            border: 2px solid transparent;
            border-radius: 12px;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            color: var(--ficde-azul-dark);
            transition: all 0.3s;
        }

        .student-input:focus { background: white; border-color: var(--ficde-naranja); outline: none; }

        .fill-input {
            border: none;
            border-bottom: 2px solid var(--ficde-naranja);
            background: transparent;
            font-weight: 700;
            color: var(--ficde-azul-dark);
            text-align: center;
            width: 150px;
            font-size: 1.1rem;
        }

        .btn-action {
            width: 100%;
            padding: 18px;
            margin-top: 30px;
            border: none;
            border-radius: 50px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            background: linear-gradient(90deg, var(--ficde-naranja), #ff9f85);
            color: white;
            box-shadow: 0 6px 20px rgba(230, 129, 97, 0.4);
            transition: transform 0.2s;
        }

        .btn-action:hover { transform: translateY(-3px); }

        .btn-back {
            background: transparent;
            color: var(--texto-secundario);
            box-shadow: none;
            border: 2px solid #ccc;
            margin-top: 15px;
        }

        .btn-back:hover { background: #e0e0e0; color: var(--ficde-azul-dark); }

        .traffic-row, .checklist-item {
            background: white;
            margin-bottom: 12px;
            padding: 15px 20px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .traffic-row:hover, .checklist-item:hover { border-color: var(--ficde-naranja); transform: translateX(5px); }

        .traffic-btn {
            width: 35px; height: 35px;
            border-radius: 50%; border: 2px solid #ddd;
            cursor: pointer;
            opacity: 0.3;
        }

        .traffic-btn.active { opacity: 1; transform: scale(1.2); border-color: var(--ficde-azul-dark); }

        .bg-green { background: #4CAF50; }

        .bg-yellow { background: #FFC107; }

        .bg-red { background: #f44336; }

        .check-box {
            width: 24px; height: 24px;
            border: 2px solid #ccc;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
        }

        .checklist-item.selected { border-color: var(--ficde-naranja); background: #fff5f0; }

        .checklist-item.selected .check-box { background: var(--ficde-naranja); border-color: var(--ficde-naranja); color: white; }

        .feedback-area {
            margin-top: 30px;
            padding: 25px;
            border-radius: 12px;
            display: none;
            animation: slideUp 0.4s;
        }

        .feedback-success { background: var(--verde-bg); color: #1b5e20; border-left: 6px solid var(--verde-exito); }

        .feedback-retry { background: var(--naranja-bg); color: #bf360c; border-left: 6px solid #ef6c00; }

        .feedback-fail { background: #cfd8dc; color: #37474f; border-left: 6px solid #455a64; }

        #musicToggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--ficde-naranja);
            color: white;
            border: none;
            cursor: pointer;
            z-index: 100;
            font-size: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            .activity-screen { grid-template-columns: 1fr; }
            .tutor-sidebar { display: flex; align-items: center; gap: 20px; }
            .fede-avatar-large { width: 80px; height: 80px; }
            .tutor-bubble::after { display: none; }
        }
    </style>
</head>

<body>
    <!-- AUDIOS MP3 - Todos en la misma carpeta -->
    <audio id="bgMusic" loop preload="auto">
        <source src="chill-study-desk-focus-concentration-lofi-451180.mp3" type="audio/mpeg">
    </audio>

    <audio id="saludoInicial" preload="auto" src="saludoinicial.mp3"></audio>
    <audio id="mensaje1Ejercicios" preload="auto" src="mensaje1ejercicios.mp3"></audio>
    <audio id="mensaje2Ejercicios" preload="auto" src="mensaje2ejercicios.mp3"></audio>
    <audio id="mensaje3Ejercicios" preload="auto" src="mensaje3ejercicios.mp3"></audio>
    <audio id="mensaje4Ejercicios" preload="auto" src="mensaje4ejercicios.mp3"></audio>
    <audio id="respuestaCorrecta" preload="auto" src="respuestacorrecta.mp3"></audio>
    <audio id="primerError" preload="auto" src="primererror.mp3"></audio>
    <audio id="segundoError" preload="auto" src="segundoerror.mp3"></audio>
    <audio id="loLograste" preload="auto" src="lolograste.mp3"></audio>

    <audio id="hoverSound" preload="auto" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.m4a"></audio>
    <audio id="clickSound" preload="auto" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.m4a"></audio>
    <audio id="successSound" preload="auto" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.m4a"></audio>

    <button id="musicToggle" onclick="toggleMusic()">üîá</button>

    <div class="container">
        <header>
            <div class="logo-container">
                <img src="logo.png" alt="FICDE" class="logo-img" onerror="this.style.display='none'; document.getElementById('altLogo').style.display='block'">
                <h2 id="altLogo" style="display:none; color:white; font-weight:800;">FICDE</h2>
            </div>
            <div class="module-tag">M√≥dulo Primeros Auxilios</div>
        </header>

        <div id="selectionScreen">
            <div class="welcome-card">
                <div class="fede-avatar-large" onclick="playAudio('saludoInicial')">
                    <img src="personaje.gif" alt="Fede">
                </div>
                <h1 class="welcome-title">Espacio de Repaso Interactivo</h1>
                <p style="color: var(--texto-secundario); font-size: 1.1rem;">Donde el conocimiento se convierte en acci√≥n</p>
            </div>

            <div class="blocks-grid">
                <div class="block-card" onclick="startModule('sintesis')">
                    <div class="block-icon">üß†</div>
                    <div class="block-title">S√≠ntesis</div>
                    <div class="block-desc">Conceptos b√°sicos, seguridad del reanimador, OCAVE y Heimlich, heridas, hemorragias, fracturas, quemaduras y alteraciones de conciencia.</div>
                </div>

                <div class="block-card" onclick="startModule('analisis')">
                    <div class="block-icon">üîç</div>
                    <div class="block-title">An√°lisis Cr√≠tico</div>
                    <div class="block-desc">Cadena de supervivencia y RCP, control de hemorragias, manejo inicial de fracturas, quemaduras, convulsiones y cambios de glucemia.</div>
                </div>

                <div class="block-card" onclick="startModule('escenarios')">
                    <div class="block-icon">üé¨</div>
                    <div class="block-title">Escenarios</div>
                    <div class="block-desc">Situaciones de atragantamiento, inmersi√≥n, cortes profundos, ca√≠das, quemaduras, s√≠ncope, convulsiones, hipoglucemia y eventos cardiovasculares.</div>
                </div>

                <div class="block-card" onclick="startModule('practica')">
                    <div class="block-icon">‚ö°</div>
                    <div class="block-title">Pr√°ctica</div>
                    <div class="block-desc">Ejercicios de recuerdo clave, PAS, reconocimiento de OCAVE y hemorragias, mini-RCP, posici√≥n lateral y manejo seguro de quemaduras y emergencias.</div>
                </div>
            </div>
        </div>

        <div id="activityScreen" class="activity-screen">
            <div class="tutor-sidebar">
                <div class="fede-avatar-large" style="width: 100px; height: 100px; border-color: var(--ficde-naranja);" onclick="replayTutorMessage()">
                    <img src="personaje.gif" alt="Fede">
                </div>
                <div style="flex:1;">
                    <h3 style="color:var(--ficde-naranja); margin-bottom:5px;">Tutor Fede</h3>
                    <div class="tutor-bubble" id="tutorMessage"></div>
                </div>
            </div>

            <div class="activity-content" id="activityContainer"></div>
        </div>
    </div>

    <script>
        // ===== GESTI√ìN DE AUDIO MP3 =====
        const audioFiles = {
            saludoInicial: document.getElementById('saludoInicial'),
            mensaje1: document.getElementById('mensaje1Ejercicios'),
            mensaje2: document.getElementById('mensaje2Ejercicios'),
            mensaje3: document.getElementById('mensaje3Ejercicios'),
            mensaje4: document.getElementById('mensaje4Ejercicios'),
            correcto: document.getElementById('respuestaCorrecta'),
            error1: document.getElementById('primerError'),
            error2: document.getElementById('segundoError'),
            lolograste: document.getElementById('loLograste')
        };

        function playAudio(audioKey) {
            if (audioFiles[audioKey]) {
                audioFiles[audioKey].currentTime = 0;
                audioFiles[audioKey].play().catch(err => console.log('Error al reproducir audio:', err));
            }
        }

        const bgMusic = document.getElementById('bgMusic');
        const clickSoundEl = document.getElementById('clickSound');
        const successSoundEl = document.getElementById('successSound');
        const hoverSoundEl = document.getElementById('hoverSound');

        let musicOn = false;
        let audioUnlocked = false;

        function unlockAudio() {
            if (audioUnlocked) return;
            [clickSoundEl, successSoundEl, hoverSoundEl].forEach(a => {
                a.volume = 0;
                const p = a.play();
                if (p) p.then(() => { a.pause(); a.currentTime = 0; a.volume = 1; }).catch(()=>{});
            });
            audioUnlocked = true;
        }

        document.addEventListener('pointerdown', unlockAudio, { once: true });
        document.addEventListener('keydown', unlockAudio, { once: true });

        function toggleMusic() {
            unlockAudio();
            if (!musicOn) {
                bgMusic.volume = 0.1;
                bgMusic.play().catch(() => {});
                document.getElementById('musicToggle').innerText = 'üéµ';
            } else {
                bgMusic.pause();
                document.getElementById('musicToggle').innerText = 'üîá';
            }
            musicOn = !musicOn;
        }

        function playSound(type) {
            if (!audioUnlocked) return;
            try {
                if (type === 'click') { clickSoundEl.currentTime=0; clickSoundEl.volume=0.8; clickSoundEl.play().catch(()=>{}); }
                if (type === 'success') { successSoundEl.currentTime=0; successSoundEl.volume=0.8; successSoundEl.play().catch(()=>{}); }
                if (type === 'hover') { hoverSoundEl.currentTime=0; hoverSoundEl.volume=0.2; hoverSoundEl.play().catch(()=>{}); }
            } catch (e) {}
        }

        function wireUiSounds() {
            document.querySelectorAll('.block-card, .btn-action, .checklist-item, .traffic-row, .fede-avatar-large').forEach(el => {
                if (el.dataset.sound === '1') return;
                el.dataset.sound = '1';
                el.addEventListener('mouseenter', () => playSound('hover'));
                el.addEventListener('click', () => playSound('click'));
            });
        }

        window.addEventListener('load', wireUiSounds);

        // ===== NORMALIZACI√ìN DE TEXTO =====
        function normalizar(txt) {
            return txt
                .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
                .toLowerCase();
        }

       // ===== ACTIVIDADES: M√ìDULO ‚Äì PRIMEROS AUXILIOS (seg√∫n manual) ===
const modules = {

    // ===================== S√çNTESIS =====================
    sintesis: [
        {
            type: 'text',
            badge: 'Definici√≥n',
            title: 'Concepto de primeros auxilios',
            instruction: 'Con tus palabras: ¬øqu√© son los primeros auxilios y hasta cu√°ndo se aplican?',
            validation: (raw) => {
                const v = normalizar(raw);
                return (
                    (v.includes('medidas') || v.includes('acciones') || v.includes('ayuda')) &&
                    (v.includes('inmediatas') || v.includes('primeros momentos') || v.includes('escena')) &&
                    (v.includes('hasta la llegada') || v.includes('servicio de emergencia') || v.includes('asistencia sanitaria'))
                );
            },
            tutor: 'Pens√° en medidas inmediatas que se aplican en el lugar del incidente hasta que llega el servicio de emergencia.',
            explanation: 'Los primeros auxilios son medidas inmediatas que se aplican a una persona lesionada, inconsciente o s√∫bitamente enferma en el lugar del incidente y hasta la llegada de la asistencia sanitaria.'
        },
        {
            type: 'checklist',
            badge: 'Autocuidado',
            title: 'Seguridad del reanimador',
            instruction: 'Seleccion√° principios b√°sicos de seguridad para quien brinda primeros auxilios.',
            items: [
                { text: 'No exponerse a peligros y asegurar la propia integridad antes de ayudar', correct: true },
                { text: 'Convertirse en una v√≠ctima m√°s si es necesario asistir r√°pido', correct: false },
                { text: 'Evaluar posibles riesgos en la escena (tr√°nsito, electricidad, fuego, etc.)', correct: true },
                { text: 'Acercarse sin protecci√≥n a sustancias qu√≠micas desconocidas', correct: false }
            ],
            tutor: 'Record√° que primero se protege el socorrista y luego se asiste a la v√≠ctima.',
            explanation: 'El autocuidado implica reconocer peligros, evitar exponerse a riesgos y asegurar la escena antes de brindar ayuda a la v√≠ctima.'
        },
        {
            type: 'traffic',
            badge: 'OCAVE',
            title: 'Obstrucci√≥n de v√≠a a√©rea (OCAVE)',
            instruction: 'Marc√° en verde afirmaciones correctas sobre la obstrucci√≥n de la v√≠a a√©rea por cuerpo extra√±o.',
            items: [
                { text: 'Se produce cuando algo impide el paso de aire a los pulmones', color: 'green' },
                { text: 'Afecta principalmente las v√≠as respiratorias altas (faringe, laringe, tr√°quea)', color: 'green' },
                { text: 'La v√≠ctima suele mostrar el ‚Äúsigno universal de asfixia‚Äù tom√°ndose el cuello', color: 'green' },
                { text: 'Siempre permite hablar y toser con normalidad', color: 'red' }
            ],
            tutor: 'Pens√° en tos inefectiva, dificultad para respirar, cianosis y manos al cuello.',
            explanation: 'La OCAVE se reconoce por dificultad respiratoria, tos d√©bil o ausente, imposibilidad de hablar y el signo universal de asfixia.'
        },
        {
            type: 'checklist',
            badge: 'Heimlich',
            title: 'Maniobra de Heimlich en adultos',
            instruction: 'Seleccion√° pasos correctos de la maniobra de Heimlich en un adulto consciente.',
            items: [
                { text: 'Colocarse detr√°s del paciente y rodearlo por debajo de los brazos', correct: true },
                { text: 'Ubicar el pu√±o cerrado por encima del ombligo, en la l√≠nea media del abdomen', correct: true },
                { text: 'Comprimir hacia atr√°s y arriba de forma firme y repetida', correct: true },
                { text: 'Dar golpes en la espalda cuando la obstrucci√≥n es completa', correct: false }
            ],
            tutor: 'Record√° que la presi√≥n abdominal centrada genera una ‚Äútos artificial‚Äù que expulsa el cuerpo extra√±o.',
            explanation: 'La maniobra de Heimlich usa presiones abdominales bruscas hacia atr√°s y arriba para desobstruir las v√≠as a√©reas en adultos conscientes.'
        },
        {
            type: 'traffic',
            badge: 'Asfixia inmersi√≥n',
            title: 'Asfixia por inmersi√≥n',
            instruction: 'Marc√° en verde afirmaciones correctas sobre asfixia por inmersi√≥n.',
            items: [
                { text: 'Se produce por hipoxia profunda tras sumersi√≥n de la v√≠a a√©rea en agua', color: 'green' },
                { text: 'Incluye pausa respiratoria, laringoespasmo y entrada masiva de agua a pulmones', color: 'green' },
                { text: 'La maniobra de Heimlich est√° indicada como tratamiento prioritario', color: 'red' },
                { text: 'Requiere ventilaci√≥n de rescate, RCP y correcci√≥n de hipotermia', color: 'green' }
            ],
            tutor: 'Diferenci√° el manejo de OCAVE en tierra de la asfixia por inmersi√≥n en el agua.',
            explanation: 'En la asfixia por inmersi√≥n se desencadena hipoxia y compromiso multiorg√°nico, trat√°ndose con ventilaci√≥n de rescate, RCP y medidas contra la hipotermia, sin usar Heimlich.'
        },
        {
            type: 'checklist',
            badge: 'Heridas',
            title: 'Conceptos b√°sicos de heridas',
            instruction: 'Seleccion√° enunciados correctos sobre las heridas.',
            items: [
                { text: 'Son p√©rdida de continuidad de los tejidos blandos', correct: true },
                { text: 'Pueden ser abiertas o cerradas seg√∫n si se ve la separaci√≥n de tejidos', correct: true },
                { text: 'Las heridas simples afectan solo piel y suelen ser de f√°cil curaci√≥n', correct: true },
                { text: 'Una herida cerrada nunca puede asociarse a hemorragia interna', correct: false }
            ],
            tutor: 'Pens√° en profundidad, extensi√≥n, localizaci√≥n y riesgo de infecci√≥n.',
            explanation: 'Las heridas se clasifican por profundidad, localizaci√≥n, forma y riesgo de infecci√≥n, y pueden causar dolor, hemorragia, infecci√≥n y shock.'
        },
        {
            type: 'traffic',
            badge: 'Hemorragias',
            title: 'Tipos de hemorragias',
            instruction: 'Marc√° en verde los tipos de hemorragia correctamente descritos.',
            items: [
                { text: 'Hemorragia capilar: sangrado superficial de piel, f√°cil de controlar', color: 'green' },
                { text: 'Hemorragia venosa: flujo continuo, oscuro, de baja presi√≥n', color: 'green' },
                { text: 'Hemorragia arterial: sangre roja brillante que brota con cada latido', color: 'green' },
                { text: 'Todas las hemorragias externas son siempre leves y poco importantes', color: 'red' }
            ],
            tutor: 'Prest√° atenci√≥n a la presi√≥n del flujo y al tipo de vaso lesionado.',
            explanation: 'Seg√∫n el vaso afectado, las hemorragias pueden ser capilares, venosas o arteriales, variando su gravedad y dificultad de control.'
        },
        {
            type: 'checklist',
            badge: 'Fractura/Luxaci√≥n',
            title: 'Fracturas y luxaciones',
            instruction: 'Seleccion√° enunciados correctos sobre fracturas y luxaciones.',
            items: [
                { text: 'La luxaci√≥n es la p√©rdida de contacto entre superficies articulares', correct: true },
                { text: 'La fractura es la ruptura o fisura de un hueso por fuerzas superiores a su resistencia', correct: true },
                { text: 'En ambas se observa dolor intenso, inflamaci√≥n y posible deformidad', correct: true },
                { text: 'En el prehospital no se debe inmovilizar el miembro afectado', correct: false }
            ],
            tutor: 'Relacion√° dolor, deformidad, sospecha de lesi√≥n vascular/nerviosa y necesidad de inmovilizar.',
            explanation: 'Fracturas y luxaciones comprometen huesos y articulaciones, generando dolor, inflamaci√≥n y riesgo de lesiones vasculares o nerviosas, por lo que requieren inmovilizaci√≥n adecuada.'
        },
        {
            type: 'traffic',
            badge: 'Conciencia',
            title: 'P√©rdida de conciencia',
            instruction: 'Marc√° en verde afirmaciones correctas sobre la p√©rdida de conciencia.',
            items: [
                { text: 'Es la incapacidad de responder a personas y actividades', color: 'green' },
                { text: 'Puede relacionarse con alteraciones cerebrales, card√≠acas o metab√≥licas', color: 'green' },
                { text: 'Siempre es un evento banal sin importancia', color: 'red' },
                { text: 'Se debe tratar como emergencia y evaluar causas posibles', color: 'green' }
            ],
            tutor: 'Pens√° en desmayo, estados alterados de la mente y compromiso de la funci√≥n cerebral.',
            explanation: 'La p√©rdida de conciencia es un signo de alarma que requiere evaluaci√≥n urgente por posible compromiso neurol√≥gico, card√≠aco o metab√≥lico.'
        },
        {
            type: 'checklist',
            badge: 'Convulsi√≥n',
            title: 'Crisis convulsivas',
            instruction: 'Seleccion√° ideas correctas sobre las crisis convulsivas.',
            items: [
                { text: 'Son descargas el√©ctricas neuronales anormales con movimientos involuntarios', correct: true },
                { text: 'Pueden asociarse a epilepsia, hipoglucemia, fiebre alta, drogas o traumatismos', correct: true },
                { text: 'Durante la convulsi√≥n se debe introducir objetos en la boca para proteger la lengua', correct: false },
                { text: 'Luego de la convulsi√≥n puede haber un per√≠odo de somnolencia y confusi√≥n (estado postictal)', correct: true }
            ],
            tutor: 'Diferenci√° convulsi√≥n de desmayo y record√° el cuidado de la v√≠a a√©rea y el entorno.',
            explanation: 'Las crisis convulsivas se caracterizan por movimientos involuntarios, p√©rdida de conciencia y un per√≠odo postictal de recuperaci√≥n lenta de las funciones mentales.'
        }
    ],

    // ===================== AN√ÅLISIS =====================
    analisis: [
        {
            type: 'text',
            badge: 'Cadena',
            title: 'Cadena de supervivencia',
            instruction: 'Explic√° en pocas l√≠neas qu√© es la cadena de supervivencia en soporte vital b√°sico.',
            validation: (raw) => {
                const v = normalizar(raw);
                return (
                    v.includes('secuencia') &&
                    (v.includes('acciones') || v.includes('eslabon')) &&
                    (v.includes('paro') || v.includes('cardiorrespiratorio') || v.includes('emergencia')) &&
                    (v.includes('rcp') || v.includes('dea') || v.includes('desfibrilador') || v.includes('servicio de emergencias'))
                );
            },
            tutor: 'Pens√° en los eslabones: reconocer, pedir ayuda, RCP, desfibrilar, soporte avanzado y recuperaci√≥n.',
            explanation: 'La cadena de supervivencia es la secuencia coordinada de acciones (reconocer, activar emergencias, RCP precoz, desfibrilaci√≥n, soporte avanzado y recuperaci√≥n) que aumenta la posibilidad de sobrevivir a un paro cardiorrespiratorio.'
        },
        {
            type: 'checklist',
            badge: 'RCP eslabones',
            title: 'Eslabones clave de la cadena',
            instruction: 'Seleccion√° eslabones que forman parte de la cadena de supervivencia en el adulto.',
            items: [
                { text: 'Reconocimiento inmediato del paro y activaci√≥n del servicio de emergencias', correct: true },
                { text: 'RCP de alta calidad con √©nfasis en compresiones', correct: true },
                { text: 'Desfibrilaci√≥n precoz con DEA', correct: true },
                { text: 'Demorar la atenci√≥n hasta llegar al hospital', correct: false }
            ],
            tutor: 'Visualiz√° los eslabones como pasos encadenados donde cada demora reduce la supervivencia.',
            explanation: 'La supervivencia mejora cuando se reconocen r√°pido los signos de paro, se inicia RCP precoz y se aplica desfibrilaci√≥n temprana antes del soporte avanzado.'
        },
        {
            type: 'traffic',
            badge: 'RCP b√°sica',
            title: 'Principios de RCP en adultos',
            instruction: 'Marc√° en verde principios correctos de la RCP b√°sica en adultos.',
            items: [
                { text: 'Comprimir fuerte y r√°pido en el centro del t√≥rax', color: 'green' },
                { text: 'Minimizar las interrupciones de las compresiones', color: 'green' },
                { text: 'Priorizar las ventilaciones por encima de las compresiones', color: 'red' },
                { text: 'Usar DEA tan pronto como est√© disponible', color: 'green' }
            ],
            tutor: 'Pens√° en compresiones de calidad, ventilaciones adecuadas y uso precoz del DEA.',
            explanation: 'La RCP eficaz requiere compresiones tor√°cicas profundas y r√°pidas con pocas interrupciones, ventilaciones coordinadas y desfibrilaci√≥n tan pronto haya un DEA disponible.'
        },
        {
            type: 'checklist',
            badge: 'Hemorragia manejo',
            title: 'Control de hemorragias externas',
            instruction: 'Seleccion√° recomendaciones actuales para el control de hemorragias externas potencialmente mortales.',
            items: [
                { text: 'Usar un torniquete comercial como primera l√≠nea en hemorragias graves de extremidades', correct: true },
                { text: 'Aplicar presi√≥n manual directa cuando no haya torniquete o no pueda usarse', correct: true },
                { text: 'Usar ap√≥sitos hemost√°ticos como complemento de la presi√≥n directa si est√°n disponibles', correct: true },
                { text: 'Aflojar peri√≥dicamente el torniquete para ‚Äúdejar pasar algo de sangre‚Äù', correct: false }
            ],
            tutor: 'Record√° la actualizaci√≥n 2020: torniquete precoz y presi√≥n directa con ap√≥sitos hemost√°ticos seg√∫n el caso.',
            explanation: 'En hemorragias de extremidades, el torniquete comercial temprano y, en general, la presi√≥n manual directa con ap√≥sitos hemost√°ticos reducen la p√©rdida de sangre y la mortalidad.'
        },
        {
            type: 'traffic',
            badge: 'Fractura an√°lisis',
            title: 'Actuaci√≥n ante fracturas y luxaciones',
            instruction: 'Marc√° en verde actuaciones adecuadas ante sospecha de fractura o luxaci√≥n.',
            items: [
                { text: 'No movilizar al paciente si se sospecha lesi√≥n de columna, pelvis o cuello', color: 'green' },
                { text: 'Inmovilizar el miembro afectado con f√©rulas, cabestrillos o tablas', color: 'green' },
                { text: 'Intentar reducir (‚Äúacomodar‚Äù) la fractura o luxaci√≥n en el lugar', color: 'red' },
                { text: 'Aplicar fr√≠o local para disminuir dolor e inflamaci√≥n', color: 'green' }
            ],
            tutor: 'Pens√° en inmovilizar, no manipular y trasladar al centro especializado.',
            explanation: 'En fracturas o luxaciones se evita mover la articulaci√≥n, se inmoviliza el segmento afectado, se cubren heridas y se aplica fr√≠o local antes del traslado especializado.'
        },
        {
            type: 'checklist',
            badge: 'Quemaduras',
            title: 'Tipos de quemaduras y gravedad',
            instruction: 'Seleccion√° afirmaciones correctas sobre las quemaduras.',
            items: [
                { text: 'Las quemaduras de primer grado afectan solo la epidermis y son dolorosas', correct: true },
                { text: 'Las de segundo grado presentan ampollas (flictenas) y pueden ser superficiales o profundas', correct: true },
                { text: 'Las de tercer grado destruyen todo el espesor de la piel y pueden no doler por da√±o nervioso', correct: true },
                { text: 'La extensi√≥n, profundidad y localizaci√≥n no influyen en el pron√≥stico', correct: false }
            ],
            tutor: 'Record√° que cara, manos, pies, perin√©, articulaciones y circunferenciales tienen peor pron√≥stico.',
            explanation: 'La gravedad de una quemadura depende de profundidad, extensi√≥n, localizaci√≥n, edad, causa y compromiso de v√≠as respiratorias.'
        },
        {
            type: 'traffic',
            badge: 'Quemadura manejo',
            title: 'Manejo inicial de quemaduras t√©rmicas',
            instruction: 'Marc√° en verde medidas adecuadas ante quemaduras por calor.',
            items: [
                { text: 'Retirar a la v√≠ctima del agente causal lo antes posible', color: 'green' },
                { text: 'Refrescar la zona con agua fr√≠a (no helada) entre 10¬∞C y 25¬∞C', color: 'green' },
                { text: 'Aplicar hielo directamente sobre la quemadura para aliviar', color: 'red' },
                { text: 'Cubrir con ap√≥sitos limpios, secos y no adherentes', color: 'green' }
            ],
            tutor: 'Diferenci√° lo que s√≠ y lo que nunca debe hacerse en una quemadura.',
            explanation: 'El tratamiento inicial de las quemaduras t√©rmicas incluye detener la agresi√≥n, enfriar con agua fr√≠a, cubrir con ap√≥sitos adecuados y evitar hielo y pomadas caseras. '
        },
        {
            type: 'checklist',
            badge: 'Glucemia',
            title: 'Hipoglucemia e hiperglucemia',
            instruction: 'Seleccion√° enunciados correctos sobre alteraciones de la glucemia.',
            items: [
                { text: 'La glucosa es la principal fuente de energ√≠a para las c√©lulas', correct: true },
                { text: 'La hipoglucemia suele relacionarse con demasiada insulina, poca ingesta o ejercicio', correct: true },
                { text: 'La hiperglucemia aparece cuando hay mucha glucosa en sangre pero no entra en las c√©lulas', correct: true },
                { text: 'Nunca debe darse az√∫car en una emergencia diab√©tica', correct: false }
            ],
            tutor: 'Pens√° en insulina, glucag√≥n y otros factores hormonales que regulan la glucemia.',
            explanation: 'En urgencias diab√©ticas sin gluc√≥metro, administrar algo dulce a un paciente consciente puede corregir hipoglucemias y rara vez empeorar una hiperglucemia a corto plazo. '
        },
        {
            type: 'traffic',
            badge: 'Convulsi√≥n an√°lisis',
            title: 'Qu√© hacer y qu√© no en convulsiones',
            instruction: 'Marc√° en verde las acciones correctas durante una crisis convulsiva.',
            items: [
                { text: 'Retirar objetos peligrosos cercanos para evitar golpes', color: 'green' },
                { text: 'Proteger la cabeza con algo blando bajo ella', color: 'green' },
                { text: 'Sujetar fuerte al paciente para frenar sus movimientos', color: 'red' },
                { text: 'No introducir ning√∫n objeto en la boca', color: 'green' }
            ],
            tutor: 'Pens√° en mantener seguridad, v√≠a a√©rea permeable y postura adecuada despu√©s de la convulsi√≥n.',
            explanation: 'En convulsiones se protege el entorno, no se inmoviliza a la fuerza ni se introducen objetos en la boca, y al finalizar se coloca al paciente en posici√≥n lateral de seguridad.'
        },
        {
            type: 'checklist',
            badge: 'Conciencia AVDN',
            title: 'Evaluaci√≥n del estado de conciencia',
            instruction: 'Seleccion√° elementos correctos para valorar el nivel de conciencia.',
            items: [
                { text: 'Observar si responde a est√≠mulos verbales', correct: true },
                { text: 'Valorar si responde a est√≠mulos dolorosos', correct: true },
                { text: 'Comprobar si responde de forma adecuada (nombre, fecha, edad)', correct: true },
                { text: 'Suponer que est√° dormido sin realizar valoraci√≥n', correct: false }
            ],
            tutor: 'Pod√©s pensar en escalas simples como AVDN (Alerta, Verbal, Dolor, No responde).',
            explanation: 'La evaluaci√≥n de conciencia incluye respuestas a la voz, al dolor y la orientaci√≥n en persona, tiempo y lugar para detectar alteraciones cerebrales.bro desd'
        }
    ],

    // ===================== ESCENARIOS =====================
    escenarios: [
        {
            type: 'text',
            badge: 'OCAVE adulto',
            title: 'Atragantamiento en restaurante',
            instruction: 'En un restaurante, un adulto se lleva las manos al cuello, no puede hablar ni toser y se pone cian√≥tico. ¬øQu√© pasos concretos realiz√°s para ayudarlo?',
            validation: (raw) => {
                const v = normalizar(raw);
                return (
                    (v.includes('manos al cuello') || v.includes('signo de asfixia') || v.includes('atragant')) &&
                    (v.includes('animo a toser') || v.includes('si no puede toser') || v.includes('no puede hablar')) &&
                    (v.includes('colocarse detras') || v.includes('por detr√°s') || v.includes('rodear por debajo de los brazos')) &&
                    (v.includes('pu√±o') || v.includes('abdomen') || v.includes('presion hacia arriba') || v.includes('heimlich'))
                );
            },
            tutor: 'Record√° chequear si puede toser, iniciar Heimlich si la tos es inefectiva y continuar hasta desobstruir o que pierda la conciencia.',
            explanation: 'Ante un atragantamiento completo en un adulto consciente se aplica la maniobra de Heimlich con compresiones abdominales r√°pidas hacia atr√°s y arriba hasta expulsar el cuerpo extra√±o. '
        },
        {
            type: 'traffic',
            badge: 'OCAVE lactante',
            title: 'Atragantamiento en lactante',
            instruction: 'Marc√° en verde actuaciones correctas ante un lactante con obstrucci√≥n grave de la v√≠a a√©rea.',
            items: [
                { text: 'Sostener al beb√© boca abajo sobre el antebrazo y dar 5 palmadas en la espalda entre los om√≥platos', color: 'green' },
                { text: 'Si no se resuelve, girarlo boca arriba y realizar 5 compresiones tor√°cicas con 2 dedos', color: 'green' },
                { text: 'Intentar darle agua para ayudar a tragar el cuerpo extra√±o', color: 'red' },
                { text: 'Alternar palmadas y compresiones hasta que respire, tosa o llore', color: 'green' }
            ],
            tutor: 'Diferenci√° el manejo del lactante del ni√±o mayor y del adulto.',
            explanation: 'En lactantes se combinan golpes interescapulares y compresiones tor√°cicas controladas, sin usar compresiones abdominales ni ofrecer l√≠quidos. '
        },
        {
            type: 'checklist',
            badge: 'Inmersi√≥n',
            title: 'Asfixia por inmersi√≥n en pileta',
            instruction: 'Seleccion√° acciones adecuadas ante una v√≠ctima rescatada del agua, inconsciente y sin respiraci√≥n normal.',
            items: [
                { text: 'Iniciar ventilaci√≥n de rescate apenas sea seguro hacerlo', correct: true },
                { text: 'Sacar a la v√≠ctima del agua y comenzar RCP sobre superficie firme', correct: true },
                { text: 'Realizar maniobra de Heimlich para expulsar el agua de los pulmones', correct: false },
                { text: 'Vigilar y corregir la hipotermia mientras se realiza el soporte vital', correct: true }
            ],
            tutor: 'Record√° que el agua se maneja con ventilaci√≥n y RCP, no con compresiones abdominales.',
            explanation: 'En la asfixia por inmersi√≥n se priorizan ventilaci√≥n de rescate, RCP efectiva y correcci√≥n de hipotermia, sin realizar maniobra de Heimlich.'
        },
        {
            type: 'text',
            badge: 'Herida corte',
            title: 'Corte profundo en cocina',
            instruction: 'En una cocina, una persona sufre un corte profundo con abundante sangrado en el antebrazo. ¬øC√≥mo actu√°s paso a paso para controlar la hemorragia?',
            validation: (raw) => {
                const v = normalizar(raw);
                return (
                    (v.includes('presion directa') || v.includes('comprimir') || v.includes('ap√≥sito')) &&
                    (v.includes('elevar') || v.includes('miembro') || v.includes('extremidad')) &&
                    (v.includes('torniquete') || v.includes('si no se controla') || v.includes('hemorragia potencialmente mortal')) &&
                    (v.includes('servicio de emergencias') || v.includes('trasladar') || v.includes('llamar'))
                );
            },
            tutor: 'Inclu√≠ presi√≥n directa, posible uso de torniquete y solicitud de ayuda si la hemorragia es intensa.',
            explanation: 'El control de hemorragias incluye presi√≥n directa con ap√≥sitos, elevaci√≥n del miembro, torniquete en casos graves y activaci√≥n del sistema de emergencias.'
        },
        {
            type: 'traffic',
            badge: 'Fractura escenario',
            title: 'Posible fractura de pierna',
            instruction: 'Marc√° en verde acciones correctas ante una posible fractura de pierna tras una ca√≠da.',
            items: [
                { text: 'No hacer que la v√≠ctima camine para ‚Äúprobar‚Äù la pierna', color: 'green' },
                { text: 'Inmovilizar la pierna en la posici√≥n encontrada con tablillas o elementos r√≠gidos', color: 'green' },
                { text: 'Aplicar fr√≠o local protegiendo la piel', color: 'green' },
                { text: 'Manipular el miembro para ‚Äúenderezarlo‚Äù antes de inmovilizar', color: 'red' }
            ],
            tutor: 'Pens√° en inmovilizar articulaciones por encima y por debajo de la fractura.',
            explanation: 'En una posible fractura se inmoviliza el miembro sin intentar reducir la deformidad y se aplica fr√≠o local antes del traslado.'
        },
        {
            type: 'checklist',
            badge: 'Quemadura escena',
            title: 'Quemadura por agua hirviendo',
            instruction: 'Seleccion√° pasos correctos ante una quemadura con agua hirviendo en el brazo.',
            items: [
                { text: 'Retirar la ropa y accesorios cercanos a la zona quemada si no est√°n adheridos', correct: true },
                { text: 'Enfriar la zona con agua corriente fr√≠a durante varios minutos', correct: true },
                { text: 'Aplicar cremas caseras, dent√≠frico o aceite para aliviar', correct: false },
                { text: 'Cubrir con ap√≥sito limpio y seco antes del traslado si es extensa', correct: true }
            ],
            tutor: 'Record√° no reventar ampollas ni colocar sustancias no est√©riles.',
            explanation: 'El manejo inicial de quemaduras t√©rmicas requiere enfriamiento, protecci√≥n de la zona y evitar remedios caseros que empeoran la lesi√≥n.'
        },
        {
            type: 'text',
            badge: 'Desmayo',
            title: 'S√≠ncope en gimnasio',
            instruction: 'En un gimnasio, una persona se desmaya durante el ejercicio y recupera la conciencia a los pocos segundos. ¬øQu√© evaluaci√≥n y cuidados iniciales realiz√°s?',
            validation: (raw) => {
                const v = normalizar(raw);
                return (
                    (v.includes('via aerea') || v.includes('respiracion') || v.includes('circulacion')) &&
                    (v.includes('posicion supina') || v.includes('elevar piernas') || v.includes('decubito')) &&
                    (v.includes('signos vitales') || v.includes('pulso') || v.includes('frecuencia')) &&
                    (v.includes('causa') || v.includes('historia') || v.includes('preguntar') || v.includes('si vuelve a desmayarse'))
                );
            },
            tutor: 'Pens√° en evaluar ABC, posici√≥n segura, signos vitales y posibles causas como deshidrataci√≥n o hipoglucemia.',
            explanation: 'Ante un s√≠ncope se eval√∫an funciones vitales, se coloca al paciente en posici√≥n segura, se investiga la causa y se valora la necesidad de traslado. '
        },
        {
            type: 'traffic',
            badge: 'Convulsi√≥n escena',
            title: 'Convulsi√≥n en v√≠a p√∫blica',
            instruction: 'Marc√° en verde las acciones adecuadas durante y despu√©s de una convulsi√≥n en la calle.',
            items: [
                { text: 'Proteger al paciente de golpes retirando objetos cercanos', color: 'green' },
                { text: 'Aflojar ropa ajustada alrededor del cuello', color: 'green' },
                { text: 'Colocar al paciente en posici√≥n lateral de seguridad tras la convulsi√≥n', color: 'green' },
                { text: 'Sujetar con fuerza brazos y piernas para detener las sacudidas', color: 'red' }
            ],
            tutor: 'Inclu√≠ tambi√©n la observaci√≥n del tiempo que dura la crisis y el estado posterior.',
            explanation: 'La actuaci√≥n ante convulsiones prioriza seguridad, cuidado de la v√≠a a√©rea y posici√≥n de recuperaci√≥n, evitando inmovilizaciones forzadas.'
        },
        {
            type: 'checklist',
            badge: 'Hipoglucemia',
            title: 'Paciente diab√©tico mareado',
            instruction: 'Seleccion√° acciones correctas ante un diab√©tico consciente con sospecha de hipoglucemia.',
            items: [
                { text: 'Ofrecer una bebida azucarada o alimento dulce si puede tragar', correct: true },
                { text: 'Esperar sin hacer nada hasta conseguir un gluc√≥metro', correct: false },
                { text: 'Observar mejor√≠a de los s√≠ntomas tras la ingesta de az√∫car', correct: true },
                { text: 'No dar nada por boca si est√° somnoliento y con riesgo de atragantarse', correct: true }
            ],
            tutor: 'Pens√° en la diferencia de conducta seg√∫n el estado de conciencia del paciente.',
            explanation: 'En hipoglucemia sospechada se administra az√∫car oral solo si el paciente est√° consciente y puede tragar; de lo contrario, no se administra nada por boca y se requiere atenci√≥n m√©dica urgente.'
        },
        {
            type: 'text',
            badge: 'ACV/SCA',
            title: 'Signos de alarma cardiovascular y neurol√≥gica',
            instruction: 'Describ√≠ dos signos de alarma que te har√≠an sospechar un accidente cerebrovascular o un s√≠ndrome coronario agudo y la conducta que tomar√≠as.',
            validation: (raw) => {
                const v = normalizar(raw);
                return (
                    (v.includes('debilidad') || v.includes('paralisis') || v.includes('asimetria') || v.includes('habla') || v.includes('cara ca√≠da')) ||
                    (v.includes('dolor de pecho') || v.includes('opresivo') || v.includes('irradiado') || v.includes('falta de aire')) &&
                    (v.includes('emergencias') || v.includes('llamar') || v.includes('traslado') || v.includes('codigo') || v.includes('urgente'))
                );
            },
            tutor: 'Pod√©s mencionar dolor opresivo en pecho, dificultad para hablar, desviaci√≥n bucal o debilidad de un lado del cuerpo y la necesidad de activar el sistema de emergencias.',
            explanation: 'Los eventos cardiovasculares y neurol√≥gicos agudos se reconocen por signos como dolor tor√°cico intenso o d√©ficit neurol√≥gico focal y requieren activaci√≥n inmediata del sistema de emergencias.'
        }
    ],

    // ===================== PR√ÅCTICA =====================
    practica: [
        {
            type: 'blanks',
            badge: 'Definici√≥n PA',
            title: 'Recordar el concepto de primeros auxilios',
            instruction: 'Complet√°: los primeros auxilios son ______ inmediatas que se toman en el ______ del incidente y hasta la llegada de la ______ sanitaria.',
            blanks: ['medidas', 'lugar', 'asistencia'],
            tutor: 'Pens√° en ‚Äúmedidas inmediatas en la escena hasta la llegada de la ayuda profesional‚Äù.',
            explanation: 'Esta definici√≥n resume el car√°cter inmediato, el lugar de aplicaci√≥n y la duraci√≥n de los primeros auxilios.'
        },
        {
            type: 'checklist',
            badge: 'PAS',
            title: 'Secuencia de actuaci√≥n segura',
            instruction: 'Seleccion√° pasos que respeten la prioridad de seguridad del reanimador.',
            items: [
                { text: 'Evaluar peligros en la escena antes de acercarse', correct: true },
                { text: 'Usar elementos de protecci√≥n personal cuando sea posible', correct: true },
                { text: 'Acercarse sin evaluar riesgos si la v√≠ctima est√° grave', correct: false },
                { text: 'Llamar al servicio de emergencias si la situaci√≥n lo amerita', correct: true }
            ],
            tutor: 'Aunque el manual no lo nombre como PAS, la l√≥gica es Proteger, Avisar, Socorrer.',
            explanation: 'Una secuencia segura prioriza la protecci√≥n del reanimador y la activaci√≥n temprana de ayuda antes de intervenir sobre la v√≠ctima.'
        },
        {
            type: 'traffic',
            badge: 'OCAVE pr√°ctica',
            title: 'Reconocer obstrucci√≥n grave',
            instruction: 'Marc√° en verde los signos de una obstrucci√≥n grave de la v√≠a a√©rea.',
            items: [
                { text: 'Incapacidad para hablar o emitir sonidos', color: 'green' },
                { text: 'Tos d√©bil o inefectiva', color: 'green' },
                { text: 'Coloraci√≥n azulada de piel y mucosas (cianosis)', color: 'green' },
                { text: 'Tos fuerte y eficaz con buena entrada de aire', color: 'red' }
            ],
            tutor: 'Diferenci√° obstrucci√≥n parcial (tose fuerte) de la obstrucci√≥n completa.',
            explanation: 'La obstrucci√≥n grave se evidencia por incapacidad de toser o hablar, respiraci√≥n muy dificultosa y cianosis progresiva.'
        },
        {
            type: 'checklist',
            badge: 'Heridas pr√°ctica',
            title: 'Clasificar heridas por riesgo',
            instruction: 'Para cada descripci√≥n, indic√° si sugiere una herida de mayor riesgo que requiere valoraci√≥n m√©dica.',
            items: [
                { text: 'Herida profunda con hemorragia abundante y bordes irregulares', correct: true },
                { text: 'Rasgu√±o superficial lineal con poco sangrado', correct: false },
                { text: 'Herida por aplastamiento de miembro con sospecha de lesi√≥n interna', correct: true },
                { text: 'Peque√±o corte limpio que deja de sangrar con presi√≥n local', correct: false }
            ],
            tutor: 'Pens√° en profundidad, hemorragia, mecanismo y posible afectaci√≥n de estructuras internas.',
            explanation: 'Heridas profundas, por aplastamiento o con sangrado importante requieren evaluaci√≥n m√©dica por posible da√±o interno y riesgo de shock. '
        },
        {
            type: 'blanks',
            badge: 'Hemorragias tipos',
            title: 'Recordar tipos de hemorragia',
            instruction: 'Complet√°: la hemorragia ______ es superficial y f√°cil de controlar; la ______ tiene flujo continuo desde una vena; la ______ es grave, con sangre que brota al ritmo del latido.',
            blanks: ['capilar', 'venosa', 'arterial'],
            tutor: 'Us√° como pista la presi√≥n y el aspecto del sangrado.',
            explanation: 'Los tres tipos b√°sicos de hemorragia se diferencian por el vaso lesionado y la forma del sangrado. '
        },
        {
            type: 'traffic',
            badge: 'RCP pasos',
            title: 'Secuencia corta de RCP',
            instruction: 'Marc√° en verde los pasos que deben estar presentes en una secuencia b√°sica de RCP.',
            items: [
                { text: 'Comprobar respuesta y respiraci√≥n', color: 'green' },
                { text: 'Llamar al sistema de emergencias', color: 'green' },
                { text: 'Iniciar compresiones tor√°cicas en el centro del pecho', color: 'green' },
                { text: 'Esperar a que lleguen los servicios sin hacer nada si no hay respiraci√≥n', color: 'red' }
            ],
            tutor: 'Pens√° en el orden: evaluar, pedir ayuda, comprimir, ventilar y desfibrilar si es posible.',
            explanation: 'La RCP de calidad comienza con la evaluaci√≥n, la activaci√≥n de emergencias y las compresiones tor√°cicas ininterrumpidas. '
        },
        {
            type: 'checklist',
            badge: 'Posici√≥n lateral',
            title: 'Posici√≥n lateral de seguridad',
            instruction: 'Seleccion√° afirmaciones correctas sobre la posici√≥n lateral de seguridad.',
            items: [
                { text: 'Se usa en personas inconscientes que respiran y tienen pulso', correct: true },
                { text: 'Permite que secreciones y v√≥mitos drenen fuera de la boca', correct: true },
                { text: 'Est√° contraindicada si se sospecha lesi√≥n grave de columna', correct: true },
                { text: 'Se utiliza en personas sin respiraci√≥n ni pulso', correct: false }
            ],
            tutor: 'Record√° que esta posici√≥n protege la v√≠a a√©rea y se adapta seg√∫n el contexto traum√°tico.',
            explanation: 'La posici√≥n lateral de seguridad mantiene la v√≠a a√©rea permeable y reduce el riesgo de aspiraci√≥n en pacientes inconscientes que a√∫n respiran. '
        },
        {
            type: 'text',
            badge: 'Caso quemadura',
            title: 'Redactar actuaci√≥n ante quemadura qu√≠mica',
            instruction: 'Describ√≠ brevemente qu√© har√≠as ante una salpicadura de producto qu√≠mico en la piel de una persona.',
            validation: (raw) => {
                const v = normalizar(raw);
                return (
                    v.includes('retirar') &&
                    (v.includes('ropa') || v.includes('desvestir')) &&
                    (v.includes('lavar') || v.includes('abundante agua')) &&
                    (v.includes('20 minutos') || v.includes('10 minutos') || v.includes('varios minutos')) &&
                    (v.includes('no neutralizar') || v.includes('no usar neutralizante') || v.includes('no aplicar otras sustancias'))
                );
            },
            tutor: 'Inclu√≠ retirar al paciente del agente, quitar ropa contaminada, lavar con abundante agua y no usar neutralizantes qu√≠micos.',
            explanation: 'Las quemaduras qu√≠micas se manejan retirando el agente, removiendo ropa contaminada, irrigando prolongadamente con agua y trasladando a un centro especializado. '
        },
        {
            type: 'traffic',
            badge: 'NO hacer',
            title: 'Lo que nunca debe hacerse',
            instruction: 'Marc√° en rojo las acciones que nunca deben realizarse en primeros auxilios.',
            items: [
                { text: 'Introducir objetos en la boca de una persona que convulsiona', color: 'red' },
                { text: 'Aplicar hielo directamente sobre una quemadura', color: 'red' },
                { text: 'Dar de beber a una persona inconsciente', color: 'red' },
                { text: 'Aflojar ropa ajustada y controlar signos vitales', color: 'green' }
            ],
            tutor: 'Este ejercicio ayuda a fijar errores frecuentes que pueden agravar la situaci√≥n.',
            explanation: 'Ciertas maniobras mal aplicadas aumentan el da√±o, por lo que deben evitarse sistem√°ticamente en primeros auxilios. '
        },
        {
            type: 'checklist',
            badge: 'Rol auxiliar',
            title: 'Rol del auxiliar en primeros auxilios',
            instruction: 'Seleccion√° responsabilidades propias de un auxiliar entrenado en primeros auxilios.',
            items: [
                { text: 'Aplicar medidas b√°sicas mientras llega el servicio de emergencia', correct: true },
                { text: 'Respetar siempre su propio l√≠mite de entrenamiento y competencias', correct: true },
                { text: 'Administrar f√°rmacos avanzados sin indicaci√≥n m√©dica', correct: false },
                { text: 'Colaborar en la prevenci√≥n y educaci√≥n sobre seguridad y emergencias', correct: true }
            ],
            tutor: 'Pens√° en un rol de puente entre la comunidad y el sistema de emergencias, sin sustituir al personal m√©dico.',
            explanation: 'El auxiliar capacitado puede salvar vidas con intervenciones b√°sicas, siempre dentro de su campo de entrenamiento y coordinado con el sistema sanitario.'
        }
    ]
};

        let currentModule = '';
        let currentIndex = 0;
        let attemptCount = 0;
        let lastAudioModule = null;

        // ===== MAPEO DE M√ìDULOS A AUDIOS =====
        const moduloAudioMap = {
            'sintesis': 'mensaje1',
            'analisis': 'mensaje2',
            'escenarios': 'mensaje3',
            'practica': 'mensaje4'
        };

        function startModule(id) {
            playSound('click');
            currentModule = id;
            currentIndex = 0;
            attemptCount = 0;
            lastAudioModule = id;

            // Reproducir el audio del m√≥dulo correspondiente
            const audioKey = moduloAudioMap[id];
            if (audioKey) {
                playAudio(audioKey);
            }

            document.getElementById('selectionScreen').style.display = 'none';
            document.getElementById('activityScreen').classList.add('active');

            setTimeout(loadActivity, 300);
        }

        function loadActivity() {
            attemptCount = 0;

            if (currentIndex >= modules[currentModule].length) {
                // Reproducir "lolograste.mp3" al terminar TODAS las preguntas
                playAudio('lolograste');
                playSound('success');
                alert('¬°Excelente! Completaste este bloque.');
                setTimeout(() => {
                    location.reload();
                }, 2000);
                return;
            }

            const data = modules[currentModule][currentIndex];
            const container = document.getElementById('activityContainer');

            const msg = `Pregunta ${currentIndex + 1} de ${modules[currentModule].length}: ${data.tutor}`;
            document.getElementById('tutorMessage').innerText = msg;

            let html = `<span class="act-badge">${data.badge}</span>
                        <h2 class="act-title">${data.title}</h2>
                        <p class="act-instruction">${data.instruction}</p>`;

            if (data.type === 'text') {
                html += `<textarea id="txtInput" class="student-input" placeholder="Escribe tu respuesta con tus palabras..."></textarea>`;
            } else if (data.type === 'blanks') {
                html += `<div style="font-size:1.2rem; line-height:2.5;">`;
                data.blanks.forEach((b, i) => {
                    html += `${i + 1}. <input type="text" class="fill-input" data-ans="${b}"> <br>`;
                });
                html += `</div>`;
            } else if (data.type === 'traffic') {
                data.items.forEach((item, i) => {
                    html += `<div class="traffic-row" id="row-${i}">
                                <span>${item.text}</span>
                                <div style="display:flex; gap:10px;">
                                    <div class="traffic-btn bg-green" onclick="selTraffic(${i}, 'green')"></div>
                                    <div class="traffic-btn bg-yellow" onclick="selTraffic(${i}, 'yellow')"></div>
                                    <div class="traffic-btn bg-red" onclick="selTraffic(${i}, 'red')"></div>
                                </div>
                            </div>`;
                });
            } else if (data.type === 'checklist') {
                data.items.forEach((item) => {
                    html += `<div class="checklist-item" onclick="toggleCheck(this)" data-correct="${item.correct}">
                                <div class="check-box"></div>
                                <span>${item.text}</span>
                            </div>`;
                });
            }

            html += `<div id="feedback" class="feedback-area"></div>
                     <button id="btnCheck" class="btn-action" onclick="validate()">Verificar respuesta</button>
                     <button class="btn-action btn-back" onclick="location.reload()">Salir al men√∫</button>`;

            container.innerHTML = html;
            wireUiSounds();
        }

        let trafficAns = {};

        function selTraffic(idx, color) {
            trafficAns[idx] = color;
            const row = document.getElementById(`row-${idx}`);
            row.querySelectorAll('.traffic-btn').forEach(b => b.classList.remove('active'));
            row.querySelector(`.bg-${color}`).classList.add('active');
            playSound('click');
        }

        function toggleCheck(el) {
            el.classList.toggle('selected');
            el.querySelector('.check-box').innerText = el.classList.contains('selected') ? '‚úì' : '';

            if (el.classList.contains('selected')) {
                el.style.borderColor = 'var(--ficde-naranja)';
                el.querySelector('.check-box').style.background = 'var(--ficde-naranja)';
                el.querySelector('.check-box').style.borderColor = 'var(--ficde-naranja)';
                el.querySelector('.check-box').style.color = 'white';
            } else {
                el.style.borderColor = 'transparent';
                el.querySelector('.check-box').style.background = 'transparent';
                el.querySelector('.check-box').style.borderColor = '#ccc';
            }

            playSound('click');
        }

        function validate() {
            const data = modules[currentModule][currentIndex];
            const feedback = document.getElementById('feedback');
            let isCorrect = false;

            if (data.type === 'text') {
                const val = document.getElementById('txtInput').value;
                isCorrect = data.validation(val);
            } else if (data.type === 'blanks') {
                const inputs = document.querySelectorAll('.fill-input');
                let hits = 0;
                inputs.forEach(inp => {
                    const v = normalizar(inp.value);
                    const ans = normalizar(inp.dataset.ans);
                    if (v.length > 1 && ans.startsWith(v.slice(0, Math.max(2, Math.min(v.length, ans.length))))) hits++;
                });
                isCorrect = (hits === data.blanks.length);
            } else if (data.type === 'traffic') {
                let hits = 0;
                data.items.forEach((item, i) => { if (trafficAns[i] === item.color) hits++; });
                isCorrect = (hits === data.items.length);
            } else if (data.type === 'checklist') {
                let correct = true;
                document.querySelectorAll('.checklist-item').forEach(item => {
                    const sel = item.classList.contains('selected');
                    const should = item.dataset.correct === 'true';
                    if (sel !== should) correct = false;
                });
                isCorrect = correct;
            }

            feedback.style.display = 'block';

            if (isCorrect) {
                playAudio('correcto');
                playSound('success');
                feedback.className = 'feedback-area feedback-success';
                feedback.innerHTML = `<strong>¬°Muy bien!</strong><br>${data.explanation}`;
                document.getElementById('btnCheck').innerText = 'Siguiente pregunta ‚Üí';
                document.getElementById('btnCheck').onclick = () => { currentIndex++; loadActivity(); };
            } else {
                attemptCount++;

                if (attemptCount < 2) {
                    playAudio('error1');
                    feedback.className = 'feedback-area feedback-retry';
                    feedback.innerHTML = `<strong>Buen intento.</strong> Revis√° tu respuesta. Pista: ${data.tutor}`;
                } else {
                    playAudio('error2');
                    feedback.className = 'feedback-area feedback-fail';
                    feedback.innerHTML = `<strong>No pasa nada, aprendamos juntos:</strong><br>${data.explanation}`;
                    document.getElementById('btnCheck').innerText = 'Entendido, continuar ‚Üí';
                    document.getElementById('btnCheck').onclick = () => { currentIndex++; loadActivity(); };
                }
            }
        }

        function replayTutorMessage() {
            // Replay del √∫ltimo audio de m√≥dulo reproducido
            if (lastAudioModule) {
                const audioKey = moduloAudioMap[lastAudioModule];
                if (audioKey) {
                    playAudio(audioKey);
                }
            }
        }
    </script>
</body>
</html>